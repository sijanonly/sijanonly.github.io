<!DOCTYPE html>
<html prefix="" lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="Data Exploration...">
<meta name="viewport" content="width=device-width">
<title>CODEBUG (page 3) | CODEBUG</title>
<link href="../assets/css/rst.css" rel="stylesheet" type="text/css">
<link href="../assets/css/code.css" rel="stylesheet" type="text/css">
<link href="../assets/css/theme.css" rel="stylesheet" type="text/css">
<link href="../assets/css/custom.css" rel="stylesheet" type="text/css">
<link rel="stylesheet" type="text/css" href="../assets/css/screen.css">
<link rel="stylesheet" type="text/css" href="../assets/css/nav.css">
<link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Merriweather:300,700,700italic,300italic%7COpen+Sans:700,400%7CInconsolata">
<link href="../assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="../assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" href="../rss.xml">
<link rel="canonical" href="https://sijanb.com.np/blog/">
<link rel="icon" href="../favicon.ico" sizes="16x16">
<link rel="next" href="index-2.html" type="text/html">
<!--[if lt IE 9]><script src="../assets/js/html5.js"></script><![endif]-->
</head>
<body class="nav-closed">

<div class="nav">
    <h3 class="nav-title">Menu</h3>
    <a href="#" class="nav-close">
        <span class="hidden">Close</span>
    </a>
    <ul>
<li class="nav-opened nav-current" role="presentation">
            <a href=".">Blog</a>
        </li>
        <li class="nav-opened" role="presentation">
            <a href="../categories/">Tags</a>
        </li>
        <li class="nav-opened" role="presentation">
            <a href="../rss.xml">RSS feed</a>
        </li>
    
    
    </ul>
</div>
<span class="nav-cover"></span>

<div class="site-wrapper">
    <header class="main-header post-head no-cover"><nav class="main-nav overlay clearfix"><a class="blog-logo" href="https://sijanb.com.np/"><img src="../images/logo.png" alt="Blog Logo"></a>
            <a class="menu-button" href="#"><span class="burger">☰</span><span class="word">Menu</span></a>
        </nav><div class="vertical">
            <div class="main-header-content inner">
                <h1 class="page-title">CODEBUG (page 3)</h1>
                <h2 class="page-description">Data Exploration...</h2>
            </div>
        </div>
        <a class="scroll-down icon-arrow-left" href="#content"><span class="hidden">Scroll Down</span></a>
    </header><main id="content" class="content" role="main"><div class="postindex">


<article class="post post"><header class="post-header"><h2 class="post-title"><a href="../posts/paper-summary-policy-gradient-methods-for/">Paper Summary : Policy Gradient Methods for</a></h2>
    </header><section class="post-excerpt"><div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Summary of the paper <a href="https://homes.cs.washington.edu/~todorov/courses/amath579/reading/PolicyGradient.pdf">"Policy Gradient Methods for Reinforcement Learning with Function Approximation"</a></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h5 id="Motivation">Motivation<a class="anchor-link" href="../posts/paper-summary-policy-gradient-methods-for/#Motivation">¶</a>
</h5>
<p>Reinforcement Learning (RL) solves the problem of learning through experiments in the (dynamic) environments. The learner objective is to find an optimal policy which can guide the agent for the nagivation. This optimal policy is formulated in terms of maximizing future reward of the agent. Value-function $ V_{\pi} (s) $ and action-value function $ Q_{\pi}(s,a) $ are the measure of potential future rewards.</p>
<ul>
<li>$ V_{\pi} (s) $ : Goodness measure to be in a state s and then following policy $ \pi $</li>
<li>$ Q_{\pi}(s,a) $ : Goodness measure to be in a state s, perform action a and then follow policy $ \pi $</li>
</ul>
<p>NOTE</p>
<ul>
<li>Both $ V_{\pi} (s) $ and $ Q_{\pi}(s,a) $ are related to rewards in terms of expectation of the discounted future reards and their values are maintained on a lookup table.</li>
<li>Goal : We want to find the value of (state) or (state,action) in a given environment, so that the agent can follow an optimal path, collecting maximum rewards.</li>
</ul>
<p>In a large scale RL problem, maintaining lookup table will lead to the the problem of 'curse of dimensionality'. Currently, this problem is solved using function approximation. The function approximation tries to generalize the estimation of value of state or state-action value based on a set of features in a given state/observations. Most of the existing approaches follow the idea of approximating the value function and then deriving policy out of it. Authors have pointed out two major limitations of this approach:</p>
<p>a. This approach focused towards finding deterministic policy, which might not be the case for complex problems/environments.
 b. Small variation in the value estimation might cause different action selection; derived policy is sensitive.</p>
<h5 id="Contribution">Contribution<a class="anchor-link" href="../posts/paper-summary-policy-gradient-methods-for/#Contribution">¶</a>
</h5>
<p>Authors proposed an alternative way to approximate policy directly using parameterized function. So, we won't be storing any Q-values in a table, but, learnt using a function approximator. For an example, the policy can be represented by a Neural Network (NN) where we can feed state as input and get probability distribution for action selection as output. Considering $ \theta $ as parameters of the NN, representing the policy and $ \rho $ as its performance measure (which can be a loss function), then the parameter $ \theta $ will be updated as:</p>
<p>$ \theta_{t+1} \gets \theta_t + \alpha \frac{\partial {\rho}}{ \partial{\theta}} $</p>
<h6 id="Policy-Gradient-Theorem:">Policy Gradient Theorem:<a class="anchor-link" href="../posts/paper-summary-policy-gradient-methods-for/#Policy-Gradient-Theorem:">¶</a>
</h6>
<p>For any Markov Decision Process (MDP),</p>
<p>$ \nabla_{\theta} J(\theta) = \frac{\partial {\rho(\pi)}}{ \partial{\theta}} = \underset{s} \sum d^{\pi} (s)  \underset{a} \sum \frac{\partial{\pi(s,a)}}{\partial(\theta)} Q^{\pi}(s,a) $ ----------(a)</p>
<p>Here $ \rho(\pi) $ , the average rewards under current policy ($ \pi $) and $ d^{\pi}(s) $, stationary distribution of states under $ \pi $</p>
<ul>
<li>The problem with the above formulation is 'how to get Q(s,a) ?' -&gt; Q(s,a) must be estimated.</li>
</ul>
<p>We can see that the state distribution is independent of policy parameter $ \theta $. Since, gradient is independent of MDP dynamics, it allows model-free learning in RL. If we estimate the policy gradient using Monte-Carlo sampling, it will give REINFORCE algorithm.</p>
<p>In Monte-Carlo sampling, we take N trajectories using current policy $ \pi $ and collect the returns. However, these returns hae high variance and we might need many episodes for the smooth convergence. The variance is introduced due to the fact that we won't be able to collect same trajectories multiple times(.i.e movement of agent is also dynamic) using out stochastic policies in the stochastic environment.</p>
<ul>
<li>QUESTION : How to estimate Q-value in equation (a) ?</li>
</ul>
<p>Authors used a function approximation $ f_w (s,a) $ with parameters 'w' to estimate $ Q^{\pi} (s,a) $ as :</p>
<p>$ \nabla_{\theta} J(\theta) =  \underset{s} \sum d^{\pi(s)} (s)  \underset{a} \sum \frac{\partial{\pi(s,a)}}{\partial(\theta)} f_w(s,a) $ --------- (b)</p>
<p>Here $ f_w(s,a) $ is learnt by following $ \pi $ and updating 'w' by minimizing mean-square error between Q-values $ [ Q^{\pi}(s,a) - f_w(s,a) ]^2 $. The neural network/policy will predict some Q-value and also when agent take some action in the environment, we predict Q-value for a given state/action. Algorithm will try to make sure difference between these two remains as close as possible.</p>
<p>The resulting formulation (b) gives the idea of actor-critic architecture for RL where</p>
<p>i. $ \pi(s,a) $ is the actor which is learning to approximate the policy by maximixing (b)</p>
<p>ii. The critic $ f_w(s,a) $ learning to estimate the policy by minimizing MSE with estimated and true Q-values.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
</div>
    </section><footer class="post-meta">
                Sijan Bhandari

        on

        <time class="post-date" datetime="2020-11-01T02:03:54+05:45">
            2020-11-01 02:03
        </time></footer></article><article class="post post"><header class="post-header"><h2 class="post-title"><a href="../posts/paper-summary-proximal-policy-optimization-algorithms/">Paper Summary : Proximal Policy Optimization Algorithms</a></h2>
    </header><section class="post-excerpt"><div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Summary of the paper <a href="https://arxiv.org/abs/1707.06347">"Proximal Policy Optimization Algorithms"</a></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h5 id="Motivation">Motivation<a class="anchor-link" href="../posts/paper-summary-proximal-policy-optimization-algorithms/#Motivation">¶</a>
</h5>
<p>Deep Q learning, 'Vanilla' Policy Gradient, REINFORCE are the examples of approaches for function approximation in RL. When it comes to RL, robustness and sample efficiency are the measures that defines effectivenss of the applied algorithm.</p>
<p>In RL formulation, the agent needs to solve a task/problem in an envronment. Agent countinously interacts with the environment, which provides rewards to the agent, and thereafter agent learns a policy to navigate and tackle the problem. In every time step, RL agent has to make a decision by selecting preferrable action. To do so, agent fully relies on the information of current state and accumulated knowledge (history of rewards) up to current time step. Once the action is performed, the next state/observation is defined by some (stochastic) transition probability model. Also, reward will be signaled to the agent based on this new state information and performed action to get there. In overall, the goal of the agent is to maximize expected cumulative rewards.</p>
<p>In terms of RL, this goal can be formulated as finding a policy $ \pi (a_t | s_t) $ such that expected reward $ \mathbb{E_{\pi_{\theta, \tau}}} [G_t] $ is maximized.</p>
<p>In high dimensional/ countinous action space, policy gradient method can be used to solve this problem. In "vanilla" policy gradient method, the policy is parameterized by some parameter $ \theta $ .i.e parametric policy  $ \pi_{\theta} (a_t | s_t) $ and we directly optimize the policy by finding the optimal parameter $ \theta $.</p>
<p>Even though 'Vanilla' policy gradient/ REINFORCE are simple/easier to implement, they come with some learning issues:</p>
<p>PROBLEM : Usually give rise to high variance while estimating gradient. This is because, the objective function</p>
<p>$ J(\theta) =  \mathbb{E_{\pi_{\theta, \tau}}} (G_t) $</p>
<p>contains expectation; so we can't directly compute the exact gradient. We use stochatic gradient estimates such as REINFORCE based on some batch of trajectories. This sampling approximation adds some variance. That means, we need large number of trajectories to get the best estimation.
In addition, we can see that collecting trajectories could be a problem in complex environments-might take long time to run.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h5 id="Contribution">Contribution<a class="anchor-link" href="../posts/paper-summary-proximal-policy-optimization-algorithms/#Contribution">¶</a>
</h5>
<p>Authors have introduced a family of policy optimization methods which is build up on the basis of work of Trust-Region Policy optimization. Two main ideas:</p>
<p>a. Clipped Surrogate Objective Function : It avoids large deviations of learned policy $ \pi_{\theta} $ from old policy $ \pi_{\theta old} $; which is formulated as:</p>
<p>$ L^{clip}(\theta) = \mathbb{E}_t [ min (r_t (\theta) \hat{A_t}, clip(r_t(\theta), 1 - \epsilon, 1 + \epsilon) \hat{A_t}) ] $</p>
<p>Here $ r_t(\theta) = \frac{\pi_{\theta}(a_t | s_t)}{\pi_{\theta old}(a_t | s_t)} $</p>
<p>$ \epsilon $ is hyperparameter, which restricts the new policy from being too far from old policy. 
 $ \hat{A_t} $ can be discounted return or advantage function.</p>
<p>The clipping ensures the updates take place in "trust-region". Also, introduces less variance than vanilla gradient methods</p>
<p>b. Multiple Epochs for policy update:</p>
<p>PPO allows to run multiple epochs on the same trajectories and optimize the objective $ L^{clip}(\theta) $. This also reduces the sample inefficieny while learning. In order to collect data, PPO runs policy with parallel actors and then samples mini-batches of the data for training k-epochs using the objective function above.</p>
<p>Let's observe the behaviour of the objective function based on changes in advantage function.</p>
<p>CASE I : When $ \hat{A_t} $ is +ve :</p>
<p>The objective function can be written as :</p>
<p>$ L^{clip} (\theta) = min ( r_t(\theta), 1 + \epsilon ) \hat{A_t} $</p>
<p>Since $\hat{A_t} $ is +ve, when the action occurrence likelihood increases (i.e. $ \pi_{\theta}(a_t | s_t) $), the whole objective value will also increase.
 The min operator limits the increasing objective value. So, when  $ \pi_{\theta}(a_t | s_t) ) &gt; (1 + \epsilon) \pi_{\theta old}(a_t | s_t)  $, ceiling occurs at $ (1 + \epsilon) \hat{A_t} $</p>
<p>CASE II : When $ \hat{A_t} $ is -ve :</p>
<p>The objective function can be written as :</p>
<p>$ L^{clip} (\theta) = max ( r_t(\theta), 1 - \epsilon ) \hat{A_t} $</p>
<p>Now, the objective function value only increases when the likelihood of the action is less likely (i.e. $ if \pi_{\theta}(a_t | s_t) $ decreases, $ L^{clip} (\theta) $ increases )
In this case, when $  (1 - \epsilon) \pi_{\theta old}(a_t | s_t) &gt; \pi_{\theta}(a_t | s_t) )   $, max operator limits the value at $ (1 - \epsilon) \pi_{\theta old}(a_t | s_t) \hat{A_t} $</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
</div>
    </section><footer class="post-meta">
                Sijan Bhandari

        on

        <time class="post-date" datetime="2020-10-31T22:22:42+05:45">
            2020-10-31 22:22
        </time></footer></article><article class="post post"><header class="post-header"><h2 class="post-title"><a href="../posts/paper-summary-learning-what-data-to-learn/">Paper Summary : Learning What Data to Learn</a></h2>
    </header><section class="post-excerpt"><div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Summary of the paper <a href="https://arxiv.org/pdf/1702.08635.pdf">"Learning What Data to Learn"</a></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h5 id="Motivation">Motivation<a class="anchor-link" href="../posts/paper-summary-learning-what-data-to-learn/#Motivation">¶</a>
</h5>
<p>The performance of learning algorithms based on Machine Learning or Deep Learning rely on amount of training data. Having more data points also has benefit of learning more generalized models and avoiding overfitting. However, collecting data is a painstalking work. Instead, we can learn automatic and adaptive data selection in the training process and make learning faster with minimal data points.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h5 id="Contribution">Contribution<a class="anchor-link" href="../posts/paper-summary-learning-what-data-to-learn/#Contribution">¶</a>
</h5>
<p>In this paper, authors have introduced  Neural Data Filter (NDF) as an adaptive framework which can learn data selection policy using deep reinforcement learning(DRL) algorithm 'Policy Gradient'.
Two important aspects of this framework:</p>
<p>a. NDF filter the data instances from randomly fetched mini-batches of data during training process.
b. Training loop provides feedback to NDF policy based on reward signal (e.g. calculated in validation set) and NDF policy is trained using DRL.</p>
<h6 id="NDF-in-detail">NDF in detail<a class="anchor-link" href="../posts/paper-summary-learning-what-data-to-learn/#NDF-in-detail">¶</a>
</h6>
<p>NDF is designed to filter out some portion of training data based on some quality measure. The filtered high-quality data points speed up the convergence of the model.</p>
<p>In order to formulate Markov Decision Process (MDP) in NDF, authors used 'SGD-MDP' with following tuple:
&lt;s, a, P, r, $ \gamma $&gt;</p>
<ul>
<li>s : representing mini-batch data and current state of training model (weights/biases) as a state</li>
<li>a : binary filtering actions;  $ a = {\{a_m\}}_{m=1}^M \in (0, 1)^M $, M-batch size and $ a_m \in \{0,1\} $
indicating whether a particular data instance in minibatch will be selected or not.</li>
<li>P : P(s`| s, a) is a transition probability</li>
<li>r = r(s,a), reward signal based on performance of the current model under consideration (e.g. validation accuracy), </li>
<li>$ \gamma \in [0,1] $, discounting factor</li>
</ul>
<p>The  NDF policy A(s,a, $ \Theta $) can be represented by a binary classification algorithm such as logistic regression or deep NN, where $ \Theta $ is policy parameter and it is updated as:</p>
<p>$ \Theta \gets \Theta + \alpha V_t \sum_m \frac{\partial log P_{\Theta} (a_m|s_m)}{\partial \Theta} $</p>
<p>and, $ V_t $ is the sampled estimation of reward $ R(s_t, a_t) $ from one episode.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
</div>
    </section><footer class="post-meta">
                Sijan Bhandari

        on

        <time class="post-date" datetime="2020-10-31T21:18:59+05:45">
            2020-10-31 21:18
        </time></footer></article><article class="post post"><header class="post-header"><h2 class="post-title"><a href="../posts/paper-summary-curiosity-driven-exploration-by-self-supervised-prediction/">Paper Summary : Curiosity-driven Exploration by Self-supervised Prediction</a></h2>
    </header><section class="post-excerpt"><div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Summary of the paper <a href="https://arxiv.org/abs/1705.05363">"Curiosity-driven Exploration by Self-supervised Prediction"</a></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h5 id="Motivation">Motivation<a class="anchor-link" href="../posts/paper-summary-curiosity-driven-exploration-by-self-supervised-prediction/#Motivation">¶</a>
</h5>
<p>The policy learning process in Reinforcement Learning (RL) is usually suffered due to delayed/sparse rewards. Reward is a direct signal for an agent to evaluate 'how good the current action selection is'. Since reward collection takes time, learning optimal policy also takes longer time to derive. Another factor that influence the learning process is human-designed reward function. These reward functions might not represent the optimal guidance for learning of the agent or won't be scalable to real world problems. We need a way to overcome reward sparsity and also improves exploration of the agent to make learning more robust.</p>
<p>Human learning process is not only guided by the final goal or achievement, but also driven by motivation or curiosity of the being. Curiosity adds exploratory behaviour to the agent, allowing it to acquire new skills and gain new knowledge about the environment. It also makes agent robust to perform actions which ultimately reduces uncertaintly on it's behaviours to capture the consequences of it's own action.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h5 id="Contribution">Contribution<a class="anchor-link" href="../posts/paper-summary-curiosity-driven-exploration-by-self-supervised-prediction/#Contribution">¶</a>
</h5>
<p>The authors, in this paper, proposed curiosity-driven learning by uing agent-intrinsic reward (.i.e a reward which is learnt by agent itself by understanding the current environment or possible changes in the states while navigation). In order to quantify curiosity, they have introduced "Intrinsic Curiosity Module".</p>
<h6 id="Intrinsic-Curiosity-Module-(ICM)">Intrinsic Curiosity Module (ICM)<a class="anchor-link" href="../posts/paper-summary-curiosity-driven-exploration-by-self-supervised-prediction/#Intrinsic-Curiosity-Module-(ICM)">¶</a>
</h6>
<p>The output of ICM is the state prediction error, which serves as reward for curiosity. This module has two sub-components, each represented by neural networks.</p>
<p>a. Inverse Model :</p>
<p>This model learns feature space using self-supervision. This new feature space is learnt in order to avoid features/information which are irrelevant to the agent while nagivation. Learning feature space is completed within two sub-modules:</p>
<p>i) First module encodes the raw input state ($s_t$) into a feature vector ($ \phi(s_t) $)
  ii) Second module takes $ \phi(s_t) $ and $ \phi(s_{t+1}) $) as encoded feature inputs and predicts action $ \hat{a_t} $ that agent might take to go to $ s_{t+1} $ from $ s_t $</p>
<p>$ \hat{a_t} = g(  \phi(s_t), \phi(s_{t+1}), \theta_i ) $</p>
<p>Here function g represents NN and  $ \hat{a_t} $ is estimated action. The learnable parameters $ \theta_i $ are trained with loss function representing difference between predicted action and actual action. i.e $ L_I( \hat{a_t}, a_t) $</p>
<p>b. Forward Model :</p>
<p>This is a NN which predicts the next state ($ s_{t+1} $) with inputs $  \phi(s_t) $ and action executed at $ s_t $.</p>
<p>$ \hat{\phi(s_{t+1})} = f( \phi(s_t), a_t, \theta_F) $</p>
<p>$ \hat{\phi(s_{t+1})}$ is the predicted estimation of $ \phi(s_{t+1})$ and $ \theta_F $ represents trainable parameters, with loss function as:</p>
<p>$ L_F ( \phi(s_{t+1}),  \hat{\phi(s_{t+1})}) = \frac{1}{2} ||  \hat{\phi(s_{t+1})} - \phi(s_{t+1})  ||^2 = \eta L_F $</p>
<p>Both losses can be jointly expressed as :</p>
<p>$ \underset{\theta_i, \theta_F} {max} [ (1-\beta) L_I  + \beta L_F ] $</p>
<p>NOTE:</p>
<p><strong> ICM worked with two connected modules - inverse model (which learnt the feature representation of state and next state) and forward model ( which predicts the feature representation of the next state)</strong> Curiosity can be calculated by the difference between output of forward model i.e $ \hat{\phi(s_{t+1})} $ and output of the inverse model $  \phi(s_{t+1}) $.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
</div>
    </section><footer class="post-meta">
                Sijan Bhandari

        on

        <time class="post-date" datetime="2020-10-31T20:25:29+05:45">
            2020-10-31 20:25
        </time></footer></article><article class="post post"><header class="post-header"><h2 class="post-title"><a href="../posts/paper-summary-asynchronous-methods-for-deep-reinforcement-learning/">Paper Summary : Asynchronous Methods for Deep Reinforcement Learning</a></h2>
    </header><section class="post-excerpt"><div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Summary of the paper <a href="https://arxiv.org/abs/1602.01783">"Asynchronous Methods for Deep Reinforcement Learning"</a></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h5 id="Motivation">Motivation<a class="anchor-link" href="../posts/paper-summary-asynchronous-methods-for-deep-reinforcement-learning/#Motivation">¶</a>
</h5>
<p>Deep Neural Network (DNN) is introduced to Reinforcement Learning (RL) framework in order to make function approximation easier/scable for large state-space problems. DNN itself suffers from overfitting because of the correlated data while nagivating through the environments (e.g. when we play a game, each consecutive moves of a player withing smaller timeframes looks similar, which won't contribute much for learning). In order to avoid it, people started using experience replay, where we have to store navigation experience (e.g. screenshots in games) as a buffer and we can use them later while training/updating policy/model parameters.</p>
<p>This works well, but only for off-policy algorithms like Q-learning. How to use on-policy algorithms like SARSA and make it stable learning using DNN ? Also, using experience replay introduces extra memory requirements/ computatonal delay for each update and real interaction with environment.</p>
<p>**NOTE :</p>
<ul>
<li>On-policy : The training data is generated by the same policy being trained. e.g : Reinforce</li>
<li>Off-Policy : The training data generated from another policy can be used to train the current policy. e.g : Q-learning</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h5 id="Contribution">Contribution<a class="anchor-link" href="../posts/paper-summary-asynchronous-methods-for-deep-reinforcement-learning/#Contribution">¶</a>
</h5>
<p>In this paper, authors introduced an asynchronous training process by executing multiple agents in parallel in different instances of the same environment using multiple CPU cores. It uses multithreading to run those agents and update the global model parameters asynchronously in online fashion. It is reported that this approach enables stable learning and faster convergence speed.</p>
<p>They have introduced asynchronous variants of SARSA, 1-step/n-step Q learning and advantage actor-critic algorithm. Let's discuss some details on Asynchronous Q-learning and Async. Advantage Actor critic (A3C) algorithms.</p>
<h6 id="Asynchronous-Q-Learning">Asynchronous Q-Learning<a class="anchor-link" href="../posts/paper-summary-asynchronous-methods-for-deep-reinforcement-learning/#Asynchronous-Q-Learning">¶</a>
</h6>
<p>In Deep Q-Learning (DQN), the neural network (NN) approximates the Q-value function Q(s,a, $\theta$) with loss formulated as:
$
\begin{equation}
 L_{i} (\theta_i)  = \mathbb{E} [ r + \gamma Q (s^`, a^`, \theta_{i-1}) - Q(s, a, \theta_i) ]^2 ..........(i)
 \end{equation}
 $</p>
<p>In Async 1-step Q learning, each thread maintains it's own copy of environment and agent traverse through the environment with the help of $  \epsilon $ - greedy policy. At each step, we compute teh gradient of the loss (i) and collect gradients over multiple timesteps before updating the parameters.</p>
<h6 id="Asynchronous-Advantage-Actor-Critic-(A3C)">Asynchronous Advantage Actor-Critic (A3C)<a class="anchor-link" href="../posts/paper-summary-asynchronous-methods-for-deep-reinforcement-learning/#Asynchronous-Advantage-Actor-Critic-(A3C)">¶</a>
</h6>
<p>Actor-critic method combines both value-pased and policy based methods.</p>
<p>It has a policy $ \pi(a_t | s_t; \theta) $ and value function $ V (s_t; \theta_t)$ to be learnt. It uses "forward-view", i.e. selecting actions based on its exploration strategy $ \pi (a_t | s_t; \theta) $ up to some $  t_{max} $  steps in the future, to collect up to $ t_{max} $ rewards since last update.</p>
<p>Now, policy and value functions are updated after every $ t_max $ actions as:</p>
<ul>
<li>Policy Network : $ \bigtriangledown_{\theta} log \pi(a_t | s_t; \theta) (R_t - V(s_t, \theta_v)) $</li>
<li>
<p>Value Network : $ \bigtriangledown_{v} (R - V(s_t; \theta_v))^2 $</p>
<p>In this learning framework, parallel actor-learners updates a shared model and make learning process more robust and stable</p>
</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
</div>
    </section><footer class="post-meta">
                Sijan Bhandari

        on

        <time class="post-date" datetime="2020-10-31T17:26:55+05:45">
            2020-10-31 17:26
        </time></footer></article><article class="post post"><header class="post-header"><h2 class="post-title"><a href="../posts/paper-summary-visual-reinforcement-learning-imagined-goals/">Paper Summary : Visual Reinforcement Learning Imagined Goals</a></h2>
    </header><section class="post-excerpt"><div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Summary of the paper <a href="https://arxiv.org/abs/1807.04742">"Visual Reinforcement Learning with Imagined Goals"</a></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h5 id="Motivation">Motivation<a class="anchor-link" href="../posts/paper-summary-visual-reinforcement-learning-imagined-goals/#Motivation">¶</a>
</h5>
<p>Humans can easily adjust themselves or adopt to new environments and learn new tasks by setting their own goals. In case of Reinforcement Learning framework, we have to manually design the reward function which gives an orientation towards the goal of a given task. For example, if we have to train a robot to pick a package and deliver to a destination, we have to set reward based on its distance-covered. Along with delivery task, there might be other tasks like adjusting robot-arm to pick the package based on it's shape/size or placing the package at the destination without throwing it on the ground. For each of these tasks, we can design specific-reward functions.But, it won't be practical or scalable for real-world problems where an agent has to solve many tasks synchronously.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h5 id="Contribution">Contribution<a class="anchor-link" href="../posts/paper-summary-visual-reinforcement-learning-imagined-goals/#Contribution">¶</a>
</h5>
<p>Authors proposed a reinforcement learning framework where an agent can learn general-purpose goal-conditioned polices by setting it's own synthetic goals and learning tasks to achieve those goals, without human intervention.</p>
<p>They referred this framework as "reinforcement with imagined goals" (RIG).</p>
<h6 id="Synthetic-Goals">Synthetic Goals<a class="anchor-link" href="../posts/paper-summary-visual-reinforcement-learning-imagined-goals/#Synthetic-Goals">¶</a>
</h6>
<p>Initially, the agent itself generate a set of synthetic goals by exploration through a random policy. Both state observations and goals are the image data (for example in case of robot navigation). By random policy, agent executes some random actions in the environment and the trajectories consisting of state observations are stored for later use.</p>
<p>During policy training phase, agent can randomly fetch those stored observations as a set of initial states or set of goals.</p>
<p>Now, we have all the information to train a goal-conditioned agent. Authors used Q-learning agent - Q(s,a,g), where
s - states, a- actions and g-goals to be achieved by executing action 'a'.
And, the optimal policy can be derived as : $  \pi (s,g) = \underset{a} max Q(s,a, g) $</p>
<p>In order to train this policy, two main issues need to be addressed:</p>
<p>a. How to design reward function ? Distance between images while nagivation is one possible reward. But, pixel-wise distance won't carry semantic meaning of actual distance between states and this will be also computationally involved.
b. How to represent the goal as a distribution so that we sample goals for the training?</p>
<p>Authorse resolved these issues by using Variational Autoencoders (VAE), to learn encoded representation of images. The VAE takes raw images (x) as input and generate low-dimensional latent representation (z). Using these latent representation, we have now latent states (z)  and latent goals ($ z_g $).</p>
<p>The working algorithm can be summarized as :</p>
<p>a. Initially, agent explores environment using random policy and the state observations will be stored.</p>
<p>b. VAE will be trained using raw images from (a) to learn latent representation of all state observations.</p>
<p>c. Initial states (z) and goals ($ z_g $) are sampled from  (b)</p>
<p>d. Goal-conditioned Q-function Q(z,a, $ z_g $) is trained using data from (c) and policy $ \pi_{\theta} (z, z_g) $ will be learnt in the latent space.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
</div>
    </section><footer class="post-meta">
                Sijan Bhandari

        on

        <time class="post-date" datetime="2020-10-31T15:41:42+05:45">
            2020-10-31 15:41
        </time></footer></article><article class="post post"><header class="post-header"><h2 class="post-title"><a href="../posts/designing-recommendation-system-using-k-nearest-neighbor-knn/">Designing recommendation system using K Nearest Neighbor (kNN)</a></h2>
    </header><section class="post-excerpt"><div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [30]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">'ignore'</span><span class="p">)</span>

<span class="o">%</span><span class="k">matplotlib</span> inline

<span class="c1">####  making results reproducible</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<span class="c1"># utils import</span>
<span class="kn">from</span> <span class="nn">fuzzywuzzy</span> <span class="k">import</span> <span class="n">fuzz</span>

<span class="c1"># https://grouplens.org/datasets/movielens/latest/</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [4]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># configure file path</span>
<span class="n">DATA_FOLDER</span> <span class="o">=</span> <span class="s1">'/home/lenovo/workspace/prepare/data/ml-latest-small/'</span>
<span class="c1"># data_path = os.path.join(DATA_FOLDER, 'MovieLens')</span>
<span class="n">movies_filename</span> <span class="o">=</span> <span class="s1">'movies.csv'</span>
<span class="n">ratings_filename</span> <span class="o">=</span> <span class="s1">'ratings.csv'</span>
<span class="c1"># read data</span>
<span class="n">df_movies</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">DATA_FOLDER</span><span class="p">,</span> <span class="n">movies_filename</span><span class="p">),</span>
    <span class="n">usecols</span><span class="o">=</span><span class="p">[</span><span class="s1">'movieId'</span><span class="p">,</span> <span class="s1">'title'</span><span class="p">],</span>
    <span class="n">dtype</span><span class="o">=</span><span class="p">{</span><span class="s1">'movieId'</span><span class="p">:</span> <span class="s1">'int32'</span><span class="p">,</span> <span class="s1">'title'</span><span class="p">:</span> <span class="s1">'str'</span><span class="p">})</span>

<span class="n">df_ratings</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">DATA_FOLDER</span><span class="p">,</span> <span class="n">ratings_filename</span><span class="p">),</span>
    <span class="n">usecols</span><span class="o">=</span><span class="p">[</span><span class="s1">'userId'</span><span class="p">,</span> <span class="s1">'movieId'</span><span class="p">,</span> <span class="s1">'rating'</span><span class="p">],</span>
    <span class="n">dtype</span><span class="o">=</span><span class="p">{</span><span class="s1">'userId'</span><span class="p">:</span> <span class="s1">'int32'</span><span class="p">,</span> <span class="s1">'movieId'</span><span class="p">:</span> <span class="s1">'int32'</span><span class="p">,</span> <span class="s1">'rating'</span><span class="p">:</span> <span class="s1">'float32'</span><span class="p">})</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [5]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># data = pd.read_csv("/home/lenovo/workspace/prepare/data/ml-latest-small/")</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [6]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df_movies</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[6]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead><tr style="text-align: right;">
<th></th>
      <th>movieId</th>
      <th>title</th>
    </tr></thead>
<tbody>
<tr>
<th>0</th>
      <td>1</td>
      <td>Toy Story (1995)</td>
    </tr>
<tr>
<th>1</th>
      <td>2</td>
      <td>Jumanji (1995)</td>
    </tr>
<tr>
<th>2</th>
      <td>3</td>
      <td>Grumpier Old Men (1995)</td>
    </tr>
<tr>
<th>3</th>
      <td>4</td>
      <td>Waiting to Exhale (1995)</td>
    </tr>
<tr>
<th>4</th>
      <td>5</td>
      <td>Father of the Bride Part II (1995)</td>
    </tr>
</tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [7]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df_ratings</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[7]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead><tr style="text-align: right;">
<th></th>
      <th>userId</th>
      <th>movieId</th>
      <th>rating</th>
    </tr></thead>
<tbody>
<tr>
<th>0</th>
      <td>1</td>
      <td>1</td>
      <td>4.0</td>
    </tr>
<tr>
<th>1</th>
      <td>1</td>
      <td>3</td>
      <td>4.0</td>
    </tr>
<tr>
<th>2</th>
      <td>1</td>
      <td>6</td>
      <td>4.0</td>
    </tr>
<tr>
<th>3</th>
      <td>1</td>
      <td>47</td>
      <td>5.0</td>
    </tr>
<tr>
<th>4</th>
      <td>1</td>
      <td>50</td>
      <td>5.0</td>
    </tr>
</tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [8]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.neighbors</span> <span class="k">import</span> <span class="n">NearestNeighbors</span>
<span class="n">model_knn</span> <span class="o">=</span> <span class="n">NearestNeighbors</span><span class="p">(</span><span class="n">metric</span><span class="o">=</span><span class="s1">'cosine'</span><span class="p">,</span> <span class="n">algorithm</span><span class="o">=</span><span class="s1">'brute'</span><span class="p">,</span> <span class="n">n_neighbors</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [11]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">num_users</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df_ratings</span><span class="o">.</span><span class="n">userId</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
<span class="n">num_items</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df_ratings</span><span class="o">.</span><span class="n">movieId</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'There are </span><span class="si">{}</span><span class="s1"> unique users and </span><span class="si">{}</span><span class="s1"> unique movies in this data set'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">num_users</span><span class="p">,</span> <span class="n">num_items</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>There are 610 unique users and 9724 unique movies in this data set
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [12]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df_ratings_cnt_tmp</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">df_ratings</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">'rating'</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">'count'</span><span class="p">])</span>
<span class="n">df_ratings_cnt_tmp</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[12]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th></th>
      <th>count</th>
    </tr>
<tr>
<th>rating</th>
      <th></th>
    </tr>
</thead>
<tbody>
<tr>
<th>0.5</th>
      <td>1370</td>
    </tr>
<tr>
<th>1.0</th>
      <td>2811</td>
    </tr>
<tr>
<th>1.5</th>
      <td>1791</td>
    </tr>
<tr>
<th>2.0</th>
      <td>7551</td>
    </tr>
<tr>
<th>2.5</th>
      <td>5550</td>
    </tr>
<tr>
<th>3.0</th>
      <td>20047</td>
    </tr>
<tr>
<th>3.5</th>
      <td>13136</td>
    </tr>
<tr>
<th>4.0</th>
      <td>26818</td>
    </tr>
<tr>
<th>4.5</th>
      <td>8551</td>
    </tr>
<tr>
<th>5.0</th>
      <td>13211</td>
    </tr>
</tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [13]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># there are a lot more counts in rating of zero</span>
<span class="n">total_cnt</span> <span class="o">=</span> <span class="n">num_users</span> <span class="o">*</span> <span class="n">num_items</span>
<span class="n">rating_zero_cnt</span> <span class="o">=</span> <span class="n">total_cnt</span> <span class="o">-</span> <span class="n">df_ratings</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="c1"># append counts of zero rating to df_ratings_cnt</span>
<span class="n">df_ratings_cnt</span> <span class="o">=</span> <span class="n">df_ratings_cnt_tmp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">'count'</span><span class="p">:</span> <span class="n">rating_zero_cnt</span><span class="p">},</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">]),</span>
    <span class="n">verify_integrity</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>
<span class="n">df_ratings_cnt</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[13]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead><tr style="text-align: right;">
<th></th>
      <th>count</th>
    </tr></thead>
<tbody>
<tr>
<th>0.0</th>
      <td>5830804</td>
    </tr>
<tr>
<th>0.5</th>
      <td>1370</td>
    </tr>
<tr>
<th>1.0</th>
      <td>2811</td>
    </tr>
<tr>
<th>1.5</th>
      <td>1791</td>
    </tr>
<tr>
<th>2.0</th>
      <td>7551</td>
    </tr>
<tr>
<th>2.5</th>
      <td>5550</td>
    </tr>
<tr>
<th>3.0</th>
      <td>20047</td>
    </tr>
<tr>
<th>3.5</th>
      <td>13136</td>
    </tr>
<tr>
<th>4.0</th>
      <td>26818</td>
    </tr>
<tr>
<th>4.5</th>
      <td>8551</td>
    </tr>
<tr>
<th>5.0</th>
      <td>13211</td>
    </tr>
</tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [14]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># add log count</span>
<span class="n">df_ratings_cnt</span><span class="p">[</span><span class="s1">'log_count'</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">df_ratings_cnt</span><span class="p">[</span><span class="s1">'count'</span><span class="p">])</span>
<span class="n">df_ratings_cnt</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[14]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead><tr style="text-align: right;">
<th></th>
      <th>count</th>
      <th>log_count</th>
    </tr></thead>
<tbody>
<tr>
<th>0.0</th>
      <td>5830804</td>
      <td>15.578665</td>
    </tr>
<tr>
<th>0.5</th>
      <td>1370</td>
      <td>7.222566</td>
    </tr>
<tr>
<th>1.0</th>
      <td>2811</td>
      <td>7.941296</td>
    </tr>
<tr>
<th>1.5</th>
      <td>1791</td>
      <td>7.490529</td>
    </tr>
<tr>
<th>2.0</th>
      <td>7551</td>
      <td>8.929435</td>
    </tr>
<tr>
<th>2.5</th>
      <td>5550</td>
      <td>8.621553</td>
    </tr>
<tr>
<th>3.0</th>
      <td>20047</td>
      <td>9.905835</td>
    </tr>
<tr>
<th>3.5</th>
      <td>13136</td>
      <td>9.483112</td>
    </tr>
<tr>
<th>4.0</th>
      <td>26818</td>
      <td>10.196829</td>
    </tr>
<tr>
<th>4.5</th>
      <td>8551</td>
      <td>9.053804</td>
    </tr>
<tr>
<th>5.0</th>
      <td>13211</td>
      <td>9.488805</td>
    </tr>
</tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [15]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ax</span> <span class="o">=</span> <span class="n">df_ratings_cnt</span><span class="p">[[</span><span class="s1">'count'</span><span class="p">]]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">'index'</span><span class="p">:</span> <span class="s1">'rating score'</span><span class="p">})</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s1">'rating score'</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s1">'count'</span><span class="p">,</span>
    <span class="n">kind</span><span class="o">=</span><span class="s1">'bar'</span><span class="p">,</span>
    <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span>
    <span class="n">title</span><span class="o">=</span><span class="s1">'Count for Each Rating Score (in Log Scale)'</span><span class="p">,</span>
    <span class="n">logy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">"movie rating score"</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">"number of ratings"</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[15]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>Text(0, 0.5, 'number of ratings')</pre>
</div>

</div>

<div class="output_area">

    <div class="prompt"></div>




<div class="output_png output_subarea ">
<img src="data:image/png;base64,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">
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [16]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df_ratings</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[16]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead><tr style="text-align: right;">
<th></th>
      <th>userId</th>
      <th>movieId</th>
      <th>rating</th>
    </tr></thead>
<tbody>
<tr>
<th>0</th>
      <td>1</td>
      <td>1</td>
      <td>4.0</td>
    </tr>
<tr>
<th>1</th>
      <td>1</td>
      <td>3</td>
      <td>4.0</td>
    </tr>
<tr>
<th>2</th>
      <td>1</td>
      <td>6</td>
      <td>4.0</td>
    </tr>
<tr>
<th>3</th>
      <td>1</td>
      <td>47</td>
      <td>5.0</td>
    </tr>
<tr>
<th>4</th>
      <td>1</td>
      <td>50</td>
      <td>5.0</td>
    </tr>
</tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [17]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># get rating frequency</span>
<span class="n">df_movies_cnt</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">df_ratings</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">'movieId'</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">'count'</span><span class="p">])</span>
<span class="n">df_movies_cnt</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[17]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th></th>
      <th>count</th>
    </tr>
<tr>
<th>movieId</th>
      <th></th>
    </tr>
</thead>
<tbody>
<tr>
<th>1</th>
      <td>215</td>
    </tr>
<tr>
<th>2</th>
      <td>110</td>
    </tr>
<tr>
<th>3</th>
      <td>52</td>
    </tr>
<tr>
<th>4</th>
      <td>7</td>
    </tr>
<tr>
<th>5</th>
      <td>49</td>
    </tr>
</tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [18]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># plot rating frequency of all movies</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">df_movies_cnt</span> \
    <span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">'count'</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> \
    <span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> \
    <span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span>
        <span class="n">title</span><span class="o">=</span><span class="s1">'Rating Frequency of All Movies'</span><span class="p">,</span>
        <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span>
    <span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">"movie Id"</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">"number of ratings"</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[18]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>Text(0, 0.5, 'number of ratings')</pre>
</div>

</div>

<div class="output_area">

    <div class="prompt"></div>




<div class="output_png output_subarea ">
<img src="data:image/png;base64,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">
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [19]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df_movies_cnt</span><span class="p">[</span><span class="s1">'count'</span><span class="p">]</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.05</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[19]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>1.00    329.0
0.95     47.0
0.90     27.0
0.85     17.0
0.80     12.0
0.75      9.0
0.70      7.0
0.65      5.0
Name: count, dtype: float64</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [20]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># filter data</span>
<span class="n">popularity_thres</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">popular_movies</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">df_movies_cnt</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">'count &gt;= @popularity_thres'</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">))</span>
<span class="n">df_ratings_drop_movies</span> <span class="o">=</span> <span class="n">df_ratings</span><span class="p">[</span><span class="n">df_ratings</span><span class="o">.</span><span class="n">movieId</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">popular_movies</span><span class="p">)]</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'shape of original ratings data: '</span><span class="p">,</span> <span class="n">df_ratings</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'shape of ratings data after dropping unpopular movies: '</span><span class="p">,</span> <span class="n">df_ratings_drop_movies</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>shape of original ratings data:  (100836, 3)
shape of ratings data after dropping unpopular movies:  (41360, 3)
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [21]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># get number of ratings given by every user</span>
<span class="n">df_users_cnt</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">df_ratings_drop_movies</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">'userId'</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">'count'</span><span class="p">])</span>
<span class="n">df_users_cnt</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[21]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th></th>
      <th>count</th>
    </tr>
<tr>
<th>userId</th>
      <th></th>
    </tr>
</thead>
<tbody>
<tr>
<th>1</th>
      <td>117</td>
    </tr>
<tr>
<th>2</th>
      <td>15</td>
    </tr>
<tr>
<th>3</th>
      <td>6</td>
    </tr>
<tr>
<th>4</th>
      <td>84</td>
    </tr>
<tr>
<th>5</th>
      <td>34</td>
    </tr>
</tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [22]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># plot rating frequency of all movies</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">df_users_cnt</span> \
    <span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">'count'</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> \
    <span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> \
    <span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span>
        <span class="n">title</span><span class="o">=</span><span class="s1">'Rating Frequency of All Users'</span><span class="p">,</span>
        <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span>
    <span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">"user Id"</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">"number of ratings"</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[22]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>Text(0, 0.5, 'number of ratings')</pre>
</div>

</div>

<div class="output_area">

    <div class="prompt"></div>




<div class="output_png output_subarea ">
<img src="data:image/png;base64,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">
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [23]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df_users_cnt</span><span class="p">[</span><span class="s1">'count'</span><span class="p">]</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.05</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[23]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>1.00    429.00
0.95    223.50
0.90    166.00
0.85    134.25
0.80    105.00
0.75     85.00
0.70     74.00
0.65     62.25
0.60     56.00
0.55     48.00
Name: count, dtype: float64</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [24]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># filter data</span>
<span class="n">ratings_thres</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">active_users</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">df_users_cnt</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">'count &gt;= @ratings_thres'</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">))</span>
<span class="n">df_ratings_drop_users</span> <span class="o">=</span> <span class="n">df_ratings_drop_movies</span><span class="p">[</span><span class="n">df_ratings_drop_movies</span><span class="o">.</span><span class="n">userId</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">active_users</span><span class="p">)]</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'shape of original ratings data: '</span><span class="p">,</span> <span class="n">df_ratings</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'shape of ratings data after dropping both unpopular movies and inactive users: '</span><span class="p">,</span> <span class="n">df_ratings_drop_users</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>shape of original ratings data:  (100836, 3)
shape of ratings data after dropping both unpopular movies and inactive users:  (32999, 3)
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [25]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># pivot and create movie-user matrix</span>
<span class="n">movie_user_mat</span> <span class="o">=</span> <span class="n">df_ratings_drop_users</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="s1">'movieId'</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s1">'userId'</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="s1">'rating'</span><span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># create mapper from movie title to index</span>
<span class="n">movie_to_idx</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">movie</span><span class="p">:</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">movie</span> <span class="ow">in</span> 
    <span class="nb">enumerate</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">df_movies</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">'movieId'</span><span class="p">)</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">movie_user_mat</span><span class="o">.</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">title</span><span class="p">))</span>
<span class="p">}</span>
<span class="c1"># transform matrix to scipy sparse matrix</span>
<span class="n">movie_user_mat_sparse</span> <span class="o">=</span> <span class="n">csr_matrix</span><span class="p">(</span><span class="n">movie_user_mat</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [35]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">movie_user_mat_sparse</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[35]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>&lt;450x268 sparse matrix of type '&lt;class 'numpy.float32'&gt;'
	with 32999 stored elements in Compressed Sparse Row format&gt;</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [26]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">env</span> JOBLIB_TEMP_FOLDER=/tmp
<span class="c1"># define model</span>
<span class="n">model_knn</span> <span class="o">=</span> <span class="n">NearestNeighbors</span><span class="p">(</span><span class="n">metric</span><span class="o">=</span><span class="s1">'cosine'</span><span class="p">,</span> <span class="n">algorithm</span><span class="o">=</span><span class="s1">'brute'</span><span class="p">,</span> <span class="n">n_neighbors</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># fit</span>
<span class="n">model_knn</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">movie_user_mat_sparse</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>env: JOBLIB_TEMP_FOLDER=/tmp
</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt output_prompt">Out[26]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>NearestNeighbors(algorithm='brute', leaf_size=30, metric='cosine',
                 metric_params=None, n_jobs=-1, n_neighbors=20, p=2,
                 radius=1.0)</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [36]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">fuzzy_matching</span><span class="p">(</span><span class="n">mapper</span><span class="p">,</span> <span class="n">fav_movie</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    return the closest match via fuzzy ratio. If no match found, return None</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------    </span>
<span class="sd">    mapper: dict, map movie title name to index of the movie in data</span>

<span class="sd">    fav_movie: str, name of user input movie</span>
<span class="sd">    </span>
<span class="sd">    verbose: bool, print log if True</span>

<span class="sd">    Return</span>
<span class="sd">    ------</span>
<span class="sd">    index of the closest match</span>
<span class="sd">    """</span>
    <span class="n">match_tuple</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># get match</span>
    <span class="k">for</span> <span class="n">title</span><span class="p">,</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">mapper</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">ratio</span> <span class="o">=</span> <span class="n">fuzz</span><span class="o">.</span><span class="n">ratio</span><span class="p">(</span><span class="n">title</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">fav_movie</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">ratio</span> <span class="o">&gt;=</span> <span class="mi">60</span><span class="p">:</span>
            <span class="n">match_tuple</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">title</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">ratio</span><span class="p">))</span>
    <span class="c1"># sort</span>
    <span class="n">match_tuple</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">match_tuple</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">])[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">match_tuple</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">'Oops! No match is found'</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">'Found possible matches in our database: </span><span class="si">{0}</span><span class="se">\n</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">match_tuple</span><span class="p">]))</span>
    <span class="k">return</span> <span class="n">match_tuple</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>



<span class="k">def</span> <span class="nf">make_recommendation</span><span class="p">(</span><span class="n">model_knn</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">mapper</span><span class="p">,</span> <span class="n">fav_movie</span><span class="p">,</span> <span class="n">n_recommendations</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    return top n similar movie recommendations based on user's input movie</span>


<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    model_knn: sklearn model, knn model</span>

<span class="sd">    data: movie-user matrix</span>

<span class="sd">    mapper: dict, map movie title name to index of the movie in data</span>

<span class="sd">    fav_movie: str, name of user input movie</span>

<span class="sd">    n_recommendations: int, top n recommendations</span>

<span class="sd">    Return</span>
<span class="sd">    ------</span>
<span class="sd">    list of top n similar movie recommendations</span>
<span class="sd">    """</span>
    <span class="c1"># fit</span>
    <span class="n">model_knn</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="c1"># get input movie index</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">'You have input movie:'</span><span class="p">,</span> <span class="n">fav_movie</span><span class="p">)</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="n">fuzzy_matching</span><span class="p">(</span><span class="n">mapper</span><span class="p">,</span> <span class="n">fav_movie</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">'idx is'</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span>
    <span class="c1"># inference</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">'Recommendation system start to make inference'</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">'......</span><span class="se">\n</span><span class="s1">'</span><span class="p">)</span>
    <span class="n">distances</span><span class="p">,</span> <span class="n">indices</span> <span class="o">=</span> <span class="n">model_knn</span><span class="o">.</span><span class="n">kneighbors</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">n_neighbors</span><span class="o">=</span><span class="n">n_recommendations</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="c1"># get list of raw idx of recommendations</span>
    <span class="n">raw_recommends</span> <span class="o">=</span> \
        <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">indices</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">distances</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">())),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])[:</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="c1"># get reverse mapper</span>
    <span class="n">reverse_mapper</span> <span class="o">=</span> <span class="p">{</span><span class="n">v</span><span class="p">:</span> <span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">mapper</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
    <span class="c1"># print recommendations</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">'Recommendations for </span><span class="si">{}</span><span class="s1">:'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fav_movie</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">dist</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">raw_recommends</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">'</span><span class="si">{0}</span><span class="s1">: </span><span class="si">{1}</span><span class="s1">, with distance of </span><span class="si">{2}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">reverse_mapper</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">dist</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [37]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">my_favorite</span> <span class="o">=</span> <span class="s1">'Iron Man'</span>

<span class="n">make_recommendation</span><span class="p">(</span>
    <span class="n">model_knn</span><span class="o">=</span><span class="n">model_knn</span><span class="p">,</span>
    <span class="n">data</span><span class="o">=</span><span class="n">movie_user_mat_sparse</span><span class="p">,</span>
    <span class="n">fav_movie</span><span class="o">=</span><span class="n">my_favorite</span><span class="p">,</span>
    <span class="n">mapper</span><span class="o">=</span><span class="n">movie_to_idx</span><span class="p">,</span>
    <span class="n">n_recommendations</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>You have input movie: Iron Man
Found possible matches in our database: ['Iron Man (2008)']

idx is 419
Recommendation system start to make inference
......

Recommendations for Iron Man:
1: Batman Begins (2005), with distance of 0.3474416136741638
2: Sherlock Holmes (2009), with distance of 0.34635400772094727
3: Kung Fu Panda (2008), with distance of 0.3432350754737854
4: Inception (2010), with distance of 0.3307400345802307
5: District 9 (2009), with distance of 0.31877219676971436
6: Up (2009), with distance of 0.31706738471984863
7: WALL·E (2008), with distance of 0.27033132314682007
8: Avengers, The (2012), with distance of 0.26102906465530396
9: Avatar (2009), with distance of 0.25990235805511475
10: Dark Knight, The (2008), with distance of 0.24018973112106323
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
</div>
    </section><footer class="post-meta">
                Sijan Bhandari

        on

        <time class="post-date" datetime="2020-07-18T13:20:47+05:45">
            2020-07-18 13:20
        </time></footer></article><article class="post post"><header class="post-header"><h2 class="post-title"><a href="../posts/optimizing-k-nearest-neighbors-knn-algorithm-in-python/">Optimizing k-Nearest Neighbors (kNN) algorithm in Python</a></h2>
    </header><section class="post-excerpt"><div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In this post, we will optimize our kNN implementation from previous post using Numpy and Numba.</p>
<p>For previous post, you can follow:</p>
<blockquote>
<p><a href="https://sijanb.com.np/posts/how-k-nearest-neighbors-works/">How kNN works ?</a></p>
<p><a href="http://sijanb.com.np/posts/k-nearest-neighbors-algorithm-using-python-and-scikit-learn/">K-Nearest Neighbors Algorithm using Python and Scikit-Learn?</a></p>
<p><a href="https://sijanb.com.np/posts/out-of-sample-accuracy-estimation-using-cross-validation-in-python-and-scikit-learn/">Out of sample accuracy estimation using cv in knn</a></p>
<p><a href="http://sijanb.com.np/posts/how-to-tune-hyperparameter-in-k-nearest-neighbors-classifier/">Tuning Hyperparameter in kNN</a></p>
</blockquote>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [1]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">math</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">Counter</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">'ignore'</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">numba</span>

<span class="o">%</span><span class="k">matplotlib</span> inline

<span class="c1"># making results reproducible</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Teaser">Teaser<a class="anchor-link" href="../posts/optimizing-k-nearest-neighbors-knn-algorithm-in-python/#Teaser">¶</a>
</h4>
<p>Let us first see a small example. We will calculate the sum of inverse square root between 1 to 10000, using basic pure python method and using Numpy.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [2]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">n</span> <span class="o">=</span> <span class="mi">10000</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [3]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">timeit</span> -n 100 sum([1./math.sqrt(i) for i in range(1,n)])
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>1.87 ms ± 48.2 µs per loop (mean ± std. dev. of 7 runs, 100 loops each)
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [4]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">timeit</span> -n 100 np.sum(1./np.sqrt(np.arange(1,n)))
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>52.7 µs ± 8.09 µs per loop (mean ± std. dev. of 7 runs, 100 loops each)
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [85]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="s1">'Numpy vectorized calculation is </span><span class="si">{:.0f}</span><span class="s1"> times faster than pure python in this example'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mf">1.87</span><span class="o">*</span><span class="mi">1000</span><span class="o">/</span><span class="mf">52.7</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[85]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>'Numpy vectorized calculation is 35 times faster than pure python in this example'</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Using-wine-dataset-for-kNN">Using wine dataset for kNN<a class="anchor-link" href="../posts/optimizing-k-nearest-neighbors-knn-algorithm-in-python/#Using-wine-dataset-for-kNN">¶</a>
</h4>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [7]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
    <span class="s1">'https://archive.ics.uci.edu/ml/machine-learning-databases/wine/wine.data'</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">','</span><span class="p">)</span>

<span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'CLASS'</span><span class="p">,</span> <span class="s1">'ALCOHOL_LEVEL'</span><span class="p">,</span> <span class="s1">'MALIC_ACID'</span><span class="p">,</span> <span class="s1">'ASH'</span><span class="p">,</span> <span class="s1">'ALCALINITY'</span><span class="p">,</span><span class="s1">'MAGNESIUM'</span><span class="p">,</span> <span class="s1">'PHENOLS'</span><span class="p">,</span> 
              <span class="s1">'FLAVANOIDS'</span><span class="p">,</span> <span class="s1">'NON_FLAVANOID_PHENOL'</span><span class="p">,</span> <span class="s1">'PROANTHOCYANINS'</span><span class="p">,</span> <span class="s1">'COLOR_INTENSITY'</span><span class="p">,</span> 
              <span class="s1">'HUE'</span><span class="p">,</span> <span class="s1">'OD280/OD315_DILUTED'</span><span class="p">,</span><span class="s1">'PROLINE'</span><span class="p">]</span>

<span class="c1"># Let us use only two features : 'ALCOHOL_LEVEL', 'MALIC_ACID' for this problem</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">'CLASS'</span><span class="p">,</span> <span class="s1">'ALCOHOL_LEVEL'</span><span class="p">,</span> <span class="s1">'MALIC_ACID'</span><span class="p">]]</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[7]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead><tr style="text-align: right;">
<th></th>
      <th>CLASS</th>
      <th>ALCOHOL_LEVEL</th>
      <th>MALIC_ACID</th>
    </tr></thead>
<tbody>
<tr>
<th>0</th>
      <td>1</td>
      <td>14.23</td>
      <td>1.71</td>
    </tr>
<tr>
<th>1</th>
      <td>1</td>
      <td>13.20</td>
      <td>1.78</td>
    </tr>
<tr>
<th>2</th>
      <td>1</td>
      <td>13.16</td>
      <td>2.36</td>
    </tr>
<tr>
<th>3</th>
      <td>1</td>
      <td>14.37</td>
      <td>1.95</td>
    </tr>
<tr>
<th>4</th>
      <td>1</td>
      <td>13.24</td>
      <td>2.59</td>
    </tr>
</tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [8]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># we are using 10% of the data for the testing purpose</span>

<span class="n">train_sample_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mf">0.9</span><span class="p">),</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">train_data</span><span class="p">,</span> <span class="n">test_data</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_sample_idx</span><span class="p">],</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">train_sample_idx</span><span class="p">)</span>

<span class="c1"># get features and label from train/test data</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span> <span class="o">=</span> <span class="n">train_data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">'CLASS'</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">train_data</span><span class="p">[</span><span class="s1">'CLASS'</span><span class="p">]</span>
<span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">test_data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">'CLASS'</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">test_data</span><span class="p">[</span><span class="s1">'CLASS'</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="1.-kNN-using-Python-from-scratch">1. kNN using Python from scratch<a class="anchor-link" href="../posts/optimizing-k-nearest-neighbors-knn-algorithm-in-python/#1.-kNN-using-Python-from-scratch">¶</a>
</h4>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [9]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">euclidean_distance</span><span class="p">(</span><span class="n">vector1</span><span class="p">,</span> <span class="n">vector2</span><span class="p">):</span>
    <span class="sd">'''calculate the euclidean distance, core python method</span>
<span class="sd">    input: numpy.arrays or lists</span>
<span class="sd">    return: euclidean distance</span>
<span class="sd">    '''</span>
    <span class="n">dist</span> <span class="o">=</span> <span class="p">[(</span><span class="n">a</span> <span class="o">-</span> <span class="n">b</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">vector1</span><span class="p">,</span> <span class="n">vector2</span><span class="p">)]</span>
    <span class="n">dist</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">dist</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">dist</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [10]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">predict_instance</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">test_instance</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
    <span class="n">inputs</span><span class="p">[</span><span class="s1">'distance'</span><span class="p">]</span> <span class="o">=</span> <span class="n">inputs</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">euclidean_distance</span><span class="p">,</span> <span class="n">vector2</span><span class="o">=</span><span class="n">test_instance</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="c1"># concatenate inputs and labels before sorting the distances</span>
    <span class="n">inputs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">inputs</span><span class="p">,</span> <span class="n">labels</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="c1"># sort based on distance</span>
    <span class="n">inputs</span> <span class="o">=</span> <span class="n">inputs</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">'distance'</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># pick k neighbors</span>
    <span class="n">neighbors</span> <span class="o">=</span> <span class="n">inputs</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>

    <span class="c1"># get list from dataframe column</span>
    <span class="n">classes</span> <span class="o">=</span> <span class="n">neighbors</span><span class="p">[</span><span class="s1">'CLASS'</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

    <span class="c1"># create counter of labels</span>
    <span class="n">majority_count</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">classes</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">majority_count</span><span class="o">.</span><span class="n">most_common</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">pop</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">knn</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Calculate k-nn for given k.</span>
<span class="sd">    </span>
<span class="sd">    """</span>
    <span class="n">predictions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">X_test</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">X_test</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">X_test</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
        <span class="n">predictions</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">predict_instance</span><span class="p">(</span><span class="n">X_train</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">y_train</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">row</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">predictions</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [11]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># knn = KNN(3)</span>
<span class="n">predictions</span> <span class="o">=</span> <span class="n">knn</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [12]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">true_values</span> <span class="o">=</span> <span class="n">y_test</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<span class="n">accuracy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">predictions</span> <span class="o">==</span> <span class="n">true_values</span><span class="p">)</span>
<span class="n">accuracy</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[12]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>0.7222222222222222</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="a.--%timeit-magic-command-to-observe-execution-time-for-core-python-functions">a.  %timeit magic command to observe execution time for core python functions<a class="anchor-link" href="../posts/optimizing-k-nearest-neighbors-knn-algorithm-in-python/#a.--%timeit-magic-command-to-observe-execution-time-for-core-python-functions">¶</a>
</h4>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [13]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># %%timeit</span>
<span class="c1"># -n execute the function 10 times in a loop</span>
<span class="o">%</span><span class="k">timeit</span> -n 10 knn(X_train, y_train, X_test, 3)
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>144 ms ± 11.3 ms per loop (mean ± std. dev. of 7 runs, 10 loops each)
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="b.-Line-profiling-to-see-which-functions/call-has-higher-contribution-on-execution-time">b. Line profiling to see which functions/call has higher contribution on execution time<a class="anchor-link" href="../posts/optimizing-k-nearest-neighbors-knn-algorithm-in-python/#b.-Line-profiling-to-see-which-functions/call-has-higher-contribution-on-execution-time">¶</a>
</h4>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [14]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">load_ext</span> line_profiler
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [15]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># We are profiling function knn, we supply the name using -f</span>
<span class="o">%</span><span class="k">lprun</span> -f knn knn(X_train, y_train, X_test, 3)
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">

<pre><code>Timer unit: 1e-06 s

Total time: 0.312758 s
File: &lt;ipython-input-115-bd6cbd244598&gt;
Function: knn at line 18

Line #      Hits         Time  Per Hit   % Time  Line Contents
==============================================================
    18                                           def knn(X_train, y_train, X_test, k):
    19                                               """
    20                                               Calculate k-nn for given k.
    21                                               
    22                                               """
    23         1         55.0     55.0      0.0      predictions = np.zeros(X_test.shape[0])
    24         1        586.0    586.0      0.2      X_test.reset_index(drop=True, inplace=True)
    25        19       3188.0    167.8      1.0      for index, row in X_test.iterrows():
    26        18     308928.0  17162.7     98.8          predictions[index] = predict_instance(X_train.copy(), y_train.copy(), row, k)
    27         1          1.0      1.0      0.0      return predictions</code></pre>
<p>NOTE:</p>
<ol>
<li>Time is in microseconds at mentioned at the top of the cell.</li>
<li>(Hits) shows number of times that particular line in code executed.</li>
<li>(Time) total microseconds for executing that line. (total amount of time)</li>
<li>(per Hit) = (Time)/(Hits),  average time for a single execution. </li>
<li>(% Time) fraction of time spent on that line relative to total amount of time.</li>
</ol>
<p>We can see the line number 26 is expensive one. We will improve it using numpy below.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="2.-Improving-kNN-with-numpy">2. Improving kNN with numpy<a class="anchor-link" href="../posts/optimizing-k-nearest-neighbors-knn-algorithm-in-python/#2.-Improving-kNN-with-numpy">¶</a>
</h4>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [54]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">predict_instance_numpy</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">test_instance</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
    <span class="c1"># calculate L2 norm between all training points and given test_point</span>
    <span class="n">inputs</span><span class="p">[</span><span class="s1">'distance'</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">inputs</span><span class="o">.</span><span class="n">values</span><span class="o">-</span><span class="n">test_instance</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># concatenate inputs and labels before sorting the distances</span>
    <span class="n">inputs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">inputs</span><span class="p">,</span> <span class="n">labels</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="c1"># sort based on distance</span>
    <span class="n">inputs</span> <span class="o">=</span> <span class="n">inputs</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">'distance'</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    
    <span class="c1"># pick k neighbors</span>
    <span class="n">neighbors</span> <span class="o">=</span> <span class="n">inputs</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>

    <span class="c1"># get list from dataframe column</span>
    <span class="n">classes</span> <span class="o">=</span> <span class="n">neighbors</span><span class="p">[</span><span class="s1">'CLASS'</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

    <span class="c1"># create counter of labels</span>
    <span class="n">majority_count</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">classes</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">majority_count</span><span class="o">.</span><span class="n">most_common</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">pop</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">knn_numpy</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Calculate k-nn for given k.</span>
<span class="sd">    </span>
<span class="sd">    """</span>
    <span class="n">predictions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">X_test</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">X_test</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">X_test</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
        <span class="n">predictions</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">predict_instance_numpy</span><span class="p">(</span><span class="n">X_train</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">y_train</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">row</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">predictions</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [55]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># knn improved with distance calculation using np.linalg.norm</span>
<span class="n">predictions</span> <span class="o">=</span> <span class="n">knn_numpy</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">true_values</span> <span class="o">=</span> <span class="n">y_test</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<span class="n">accuracy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">predictions</span> <span class="o">==</span> <span class="n">true_values</span><span class="p">)</span>
<span class="n">accuracy</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[55]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>0.7222222222222222</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Observing-execution-time-and-line-profiling-after-optimizing-with-numpy">Observing execution time and line profiling after optimizing with numpy<a class="anchor-link" href="../posts/optimizing-k-nearest-neighbors-knn-algorithm-in-python/#Observing-execution-time-and-line-profiling-after-optimizing-with-numpy">¶</a>
</h4>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [56]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># %%timeit</span>
<span class="c1"># -n execute the function 10 times in a loop</span>
<span class="o">%</span><span class="k">timeit</span> -n 10 knn_numpy(X_train, y_train, X_test, 3)
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>40.6 ms ± 2.41 ms per loop (mean ± std. dev. of 7 runs, 10 loops each)
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="-The-total-execution-has-reduced-from-135-ms-to-41.2-ms-">
<span style="color:green"> The total execution has reduced from 135 ms to 41.2 ms </span><a class="anchor-link" href="../posts/optimizing-k-nearest-neighbors-knn-algorithm-in-python/#-The-total-execution-has-reduced-from-135-ms-to-41.2-ms-">¶</a>
</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [57]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># We are profiling function knn, we supply the name using -f</span>
<span class="o">%</span><span class="k">lprun</span> -f knn_numpy knn_numpy(X_train, y_train, X_test, 3)
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">

<pre><code>Timer unit: 1e-06 s

Total time: 0.094862 s
File: &lt;ipython-input-121-a0da67624daf&gt;
Function: knn_numpy at line 22

Line #      Hits         Time  Per Hit   % Time  Line Contents
==============================================================
    22                                           def knn_numpy(X_train, y_train, X_test, k):
    23                                               """
    24                                               Calculate k-nn for given k.
    25                                               
    26                                               """
    27         1         65.0     65.0      0.1      predictions = np.zeros(X_test.shape[0])
    28         1        258.0    258.0      0.3      X_test.reset_index(drop=True, inplace=True)
    29        19       3696.0    194.5      3.9      for index, row in X_test.iterrows():
    30        18      90843.0   5046.8     95.8          predictions[index] = predict_instance_numpy(X_train.copy(), y_train.copy(), row, k)
    31         1          0.0      0.0      0.0      return predictions</code></pre>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="-The-per-Hit-time-has-reduced-from-17162.7-µs-to-5046.8-µs-">
<span style="color:green"> The per Hit time has reduced from 17162.7 µs to 5046.8 µs </span><a class="anchor-link" href="../posts/optimizing-k-nearest-neighbors-knn-algorithm-in-python/#-The-per-Hit-time-has-reduced-from-17162.7-%C2%B5s-to-5046.8-%C2%B5s-">¶</a>
</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="3.-Improving-kNN-with-numba">3. Improving kNN with numba<a class="anchor-link" href="../posts/optimizing-k-nearest-neighbors-knn-algorithm-in-python/#3.-Improving-kNN-with-numba">¶</a>
</h4>
<p>Numba does it's best work when we do operations over numpy arrays. For the implemention below, I have converted pandas dataframe to numpy array and perform relevant operations.</p>
<p>For more information about <a href="https://pandas.pydata.org/pandas-docs/stable/user_guide/enhancingperf.html#using-numba">numba</a></p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [79]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">operator</span>
<span class="kn">import</span> <span class="nn">numba</span>

<span class="nd">@numba</span><span class="o">.</span><span class="n">jit</span><span class="p">(</span><span class="n">nopython</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">euclidean_distance_numba</span><span class="p">(</span><span class="n">vector1</span><span class="p">,</span> <span class="n">vector2</span><span class="p">):</span>
    <span class="sd">'''calculate the euclidean distance,</span>
<span class="sd">    '''</span>
    <span class="n">dist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">vector1</span><span class="o">-</span><span class="n">vector2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">dist</span>

<span class="nd">@numba</span><span class="o">.</span><span class="n">jit</span><span class="p">(</span><span class="n">nopython</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">predict_instance_numba</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">test_instance</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
    <span class="n">distances</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">inputs</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">))</span>
    <span class="c1"># calculate distance between test point and training points</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">inputs</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="n">distances</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">euclidean_distance_numba</span><span class="p">(</span><span class="n">inputs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">test_instance</span><span class="p">)</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="n">labels</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">labels</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">1</span><span class="p">))</span>
    
    <span class="c1"># add labels column</span>
    <span class="n">inputs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">inputs</span><span class="p">,</span> <span class="n">labels</span><span class="p">))</span>
    
    <span class="c1"># add distance column</span>
    <span class="n">inputs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">inputs</span><span class="p">,</span> <span class="n">distances</span><span class="p">))</span>
    
    <span class="c1"># sort based on distance column</span>
    <span class="n">inputs</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="n">inputs</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">argsort</span><span class="p">()]</span>
    <span class="c1"># 2nd columns contains classes, select first k values</span>
    <span class="n">neighbor_classes</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">][:</span><span class="n">k</span><span class="p">]</span>
    <span class="n">counter</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">neighbor_classes</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">counter</span><span class="p">:</span>
            <span class="n">counter</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="o">=</span> <span class="n">counter</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">counter</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">counter_sorted</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">counter</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">counter_sorted</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># @numba.jit(nopython=True)</span>
<span class="k">def</span> <span class="nf">knn_numba</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Calculate k-nn for given k.</span>
<span class="sd">    </span>
<span class="sd">    """</span>
    <span class="n">predictions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">X_test</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">X_test</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="n">predictions</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">predict_instance_numba</span><span class="p">(</span><span class="n">X_train</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">y_train</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">X_test</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">k</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">predictions</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [80]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># knn improved with distance calculation using np.linalg.norm</span>
<span class="n">predictions</span> <span class="o">=</span> <span class="n">knn_numba</span><span class="p">(</span><span class="n">X_train</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">y_train</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">X_test</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">true_values</span> <span class="o">=</span> <span class="n">y_test</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<span class="n">accuracy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">predictions</span> <span class="o">==</span> <span class="n">true_values</span><span class="p">)</span>
<span class="n">accuracy</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[80]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>0.7222222222222222</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Observing-execution-time-and-line-profiling-after-optimizing-with-numba">Observing execution time and line profiling after optimizing with numba<a class="anchor-link" href="../posts/optimizing-k-nearest-neighbors-knn-algorithm-in-python/#Observing-execution-time-and-line-profiling-after-optimizing-with-numba">¶</a>
</h4>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [81]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># %%timeit</span>
<span class="c1"># -n execute the function 10 times in a loop</span>
<span class="o">%</span><span class="k">timeit</span> -n 10 knn_numba(X_train.values, y_train.values, X_test.values, 3)
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>1.65 ms ± 362 µs per loop (mean ± std. dev. of 7 runs, 10 loops each)
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="-The-total-execution-has-reduced-from-41.2-ms-to-1.65-ms-">
<span style="color:green"> The total execution has reduced from 41.2 ms to 1.65 ms </span><a class="anchor-link" href="../posts/optimizing-k-nearest-neighbors-knn-algorithm-in-python/#-The-total-execution-has-reduced-from-41.2-ms-to-1.65-ms-">¶</a>
</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [84]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># We are profiling function knn_numba, we supply the name using -f</span>
<span class="o">%</span><span class="k">lprun</span> -f knn_numba knn_numba(X_train.values, y_train.values, X_test.values, 3)
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">

<pre><code>Timer unit: 1e-06 s

Total time: 0.002649 s
File: &lt;ipython-input-79-89228ad76421&gt;
Function: knn_numba at line 36

Line #      Hits         Time  Per Hit   % Time  Line Contents
==============================================================
    36                                           def knn_numba(X_train, y_train, X_test, k):
    37                                               """
    38                                               Calculate k-nn for given k.
    39                                               
    40                                               """
    41         1         11.0     11.0      0.4      predictions = np.zeros(X_test.shape[0])
    42        19         44.0      2.3      1.7      for i in np.arange(X_test.shape[0]):
    43        18       2593.0    144.1     97.9          predictions[i] = predict_instance_numba(X_train.copy(), y_train.copy(), X_test[i], k)
    44         1          1.0      1.0      0.0      return predictions</code></pre>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="-The-per-Hit-time-has-reduced-from-5046.8-µs-144.1-µs">
<span style="color:green"> The per Hit time has reduced from 5046.8 µs 144.1 µs</span><a class="anchor-link" href="../posts/optimizing-k-nearest-neighbors-knn-algorithm-in-python/#-The-per-Hit-time-has-reduced-from-5046.8-%C2%B5s-144.1-%C2%B5s">¶</a>
</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
</div>
    </section><footer class="post-meta">
                Sijan Bhandari

        on
                <a href="../categories/code-profiling/">#code-profiling</a>,
                <a href="../categories/knn/">#kNN</a>,
                <a href="../categories/numba/">#numba</a>,
                <a href="../categories/numpy/">#numpy</a>,

        <time class="post-date" datetime="2020-05-23T13:55:45+05:45">
            2020-05-23 13:55
        </time></footer></article><article class="post post"><header class="post-header"><h2 class="post-title"><a href="../posts/how-to-tune-hyperparameter-in-k-nearest-neighbors-classifier/">How to tune hyperparameter in K Nearest Neighbors Classifier?</a></h2>
    </header><section class="post-excerpt"><div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In this post, we will go through an approach to get optimal/tuned model for the final prediction. First, we will see how to select best 'k' in kNN using simple python example. We will then jump to using <code>sklearn</code> apis to explore different options for hyperparameter tuning.</p>
<p>For previous post, you can follow:</p>
<blockquote>
<p><a href="https://sijanb.com.np/posts/how-k-nearest-neighbors-works/">How kNN works ?</a></p>
<p><a href="http://sijanb.com.np/posts/k-nearest-neighbors-algorithm-using-python-and-scikit-learn/">K-Nearest Neighbors Algorithm using Python and Scikit-Learn?</a></p>
<p><a href="https://sijanb.com.np/posts/out-of-sample-accuracy-estimation-using-cross-validation-in-python-and-scikit-learn/">Out of sample accuracy estimation using cv in knn</a></p>
</blockquote>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [1]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">Counter</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">'ignore'</span><span class="p">)</span>

<span class="o">%</span><span class="k">matplotlib</span> inline

<span class="c1"># making results reproducible</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [2]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
    <span class="s1">'https://archive.ics.uci.edu/ml/machine-learning-databases/wine/wine.data'</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">','</span><span class="p">)</span>

<span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'CLASS'</span><span class="p">,</span> <span class="s1">'ALCOHOL_LEVEL'</span><span class="p">,</span> <span class="s1">'MALIC_ACID'</span><span class="p">,</span> <span class="s1">'ASH'</span><span class="p">,</span> <span class="s1">'ALCALINITY'</span><span class="p">,</span><span class="s1">'MAGNESIUM'</span><span class="p">,</span> <span class="s1">'PHENOLS'</span><span class="p">,</span> 
              <span class="s1">'FLAVANOIDS'</span><span class="p">,</span> <span class="s1">'NON_FLAVANOID_PHENOL'</span><span class="p">,</span> <span class="s1">'PROANTHOCYANINS'</span><span class="p">,</span> <span class="s1">'COLOR_INTENSITY'</span><span class="p">,</span> 
              <span class="s1">'HUE'</span><span class="p">,</span> <span class="s1">'OD280/OD315_DILUTED'</span><span class="p">,</span><span class="s1">'PROLINE'</span><span class="p">]</span>

<span class="c1"># Let us use only two features : 'ALCOHOL_LEVEL', 'MALIC_ACID' for this problem</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">'CLASS'</span><span class="p">,</span> <span class="s1">'ALCOHOL_LEVEL'</span><span class="p">,</span> <span class="s1">'MALIC_ACID'</span><span class="p">]]</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[2]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead><tr style="text-align: right;">
<th></th>
      <th>CLASS</th>
      <th>ALCOHOL_LEVEL</th>
      <th>MALIC_ACID</th>
    </tr></thead>
<tbody>
<tr>
<th>0</th>
      <td>1</td>
      <td>14.23</td>
      <td>1.71</td>
    </tr>
<tr>
<th>1</th>
      <td>1</td>
      <td>13.20</td>
      <td>1.78</td>
    </tr>
<tr>
<th>2</th>
      <td>1</td>
      <td>13.16</td>
      <td>2.36</td>
    </tr>
<tr>
<th>3</th>
      <td>1</td>
      <td>14.37</td>
      <td>1.95</td>
    </tr>
<tr>
<th>4</th>
      <td>1</td>
      <td>13.24</td>
      <td>2.59</td>
    </tr>
</tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="1.-kNN-and-Cross--validation-using-Python-from-Scratch">1. kNN and Cross  validation using Python from Scratch<a class="anchor-link" href="../posts/how-to-tune-hyperparameter-in-k-nearest-neighbors-classifier/#1.-kNN-and-Cross--validation-using-Python-from-Scratch">¶</a>
</h4>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [3]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">KNN</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">K</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">K</span> <span class="o">=</span> <span class="n">K</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X_train</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y_train</span> <span class="o">=</span> <span class="kc">None</span>
        
    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X_train</span> <span class="o">=</span> <span class="n">X_train</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y_train</span> <span class="o">=</span> <span class="n">y_train</span>
    
    <span class="k">def</span> <span class="nf">predict_instance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test_instance</span><span class="p">):</span>
        <span class="n">inputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">X_train</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="c1"># calculate L2 norm between all training points and given test_point</span>
        <span class="n">inputs</span><span class="p">[</span><span class="s1">'distance'</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">inputs</span><span class="o">.</span><span class="n">values</span><span class="o">-</span><span class="n">test_instance</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        
        <span class="c1"># concatenate inputs and labels before sorting the distances</span>
        <span class="n">inputs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">inputs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_train</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># sort based on distance</span>
        <span class="n">inputs</span> <span class="o">=</span> <span class="n">inputs</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">'distance'</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># pick k neighbors</span>
        <span class="n">neighbors</span> <span class="o">=</span> <span class="n">inputs</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">K</span><span class="p">)</span>

        <span class="c1"># get list from dataframe column</span>
        <span class="n">classes</span> <span class="o">=</span> <span class="n">neighbors</span><span class="p">[</span><span class="s1">'CLASS'</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

        <span class="c1"># create counter of labels</span>
        <span class="n">majority_count</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">classes</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">majority_count</span><span class="o">.</span><span class="n">most_common</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">pop</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        
        
    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X_test</span><span class="p">):</span>
        <span class="n">predictions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">X_test</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="c1"># we want out index to be start from 0</span>
        <span class="n">X_test</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">X_test</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="n">predictions</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict_instance</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">predictions</span>

<span class="k">def</span> <span class="nf">cross_validation</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">n_neighbors</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    n : # iterations</span>
<span class="sd">    k : k-fold size</span>
<span class="sd">    data: training data</span>
<span class="sd">    n_neighbors: k in knn</span>
<span class="sd">    """</span>
    <span class="n">accuracies</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="c1"># data shuffle</span>
        <span class="n">data</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">frac</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        
        <span class="n">fold</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">k</span><span class="p">)</span>
        
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>
            <span class="n">test</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="o">*</span><span class="n">fold</span><span class="p">:</span><span class="n">j</span><span class="o">*</span><span class="n">fold</span><span class="o">+</span><span class="n">fold</span><span class="p">]</span>
            <span class="n">train</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="o">~</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">test</span><span class="o">.</span><span class="n">index</span><span class="p">)]</span>
            <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">'CLASS'</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">train</span><span class="p">[</span><span class="s1">'CLASS'</span><span class="p">]</span>
            <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">test</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">'CLASS'</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">test</span><span class="p">[</span><span class="s1">'CLASS'</span><span class="p">]</span>
            
            <span class="n">knn</span> <span class="o">=</span> <span class="n">KNN</span><span class="p">(</span><span class="n">n_neighbors</span><span class="p">)</span>
            <span class="n">knn</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
            
            <span class="n">predictions</span> <span class="o">=</span> <span class="n">knn</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
            <span class="n">true_values</span> <span class="o">=</span> <span class="n">y_test</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
            <span class="n">accuracy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">predictions</span> <span class="o">==</span> <span class="n">true_values</span><span class="p">)</span>
            
            <span class="n">accuracies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">accuracy</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">accuracies</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [4]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># We will be using following settings for all the cases below</span>
<span class="n">k_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">cross_validation_fold</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">accuracies</span> <span class="o">=</span> <span class="p">[]</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="2.-Finding-optimal-k-value-for-kNN">2. Finding optimal k value for kNN<a class="anchor-link" href="../posts/how-to-tune-hyperparameter-in-k-nearest-neighbors-classifier/#2.-Finding-optimal-k-value-for-kNN">¶</a>
</h4>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [5]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">k_values</span><span class="p">:</span>
    <span class="c1"># run cross-validation with given neighbor size k</span>
    <span class="n">accuracy</span> <span class="o">=</span> <span class="n">cross_validation</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">cross_validation_fold</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
    <span class="n">accuracies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">accuracy</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">accuracies</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>[0.6411764705882353, 0.6647058823529411, 0.7470588235294118, 0.7529411764705881, 0.7588235294117647, 0.7529411764705882, 0.7529411764705881, 0.7294117647058822, 0.7823529411764707, 0.7647058823529412, 0.7705882352941177, 0.7764705882352941, 0.7705882352941176, 0.7529411764705881, 0.7411764705882352]
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [6]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">k_values</span><span class="p">,</span> <span class="n">accuracies</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'k in kNN'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'CV-Accuracy'</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">'kNN hyperparameter (k) tuning with python alone'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[6]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>Text(0.5, 0.98, 'kNN hyperparameter (k) tuning with python alone')</pre>
</div>

</div>

<div class="output_area">

    <div class="prompt"></div>




<div class="output_png output_subarea ">
<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgYAAAEjCAYAAABJtsm4AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAALEgAACxIB0t1+/AAAADl0RVh0U29mdHdhcmUAbWF0cGxvdGxpYiB2ZXJzaW9uIDMuMC4zLCBodHRwOi8vbWF0cGxvdGxpYi5vcmcvnQurowAAIABJREFUeJzs3Xl8FPX9+PHXOzcQIBzhDKfcIHIED7zAE088wKKt9caj1rb+tGr161WrbbW1taIW611PDhUVRSogKqgk3AnhFE1IIOFKuBJyvH9/zGxcl93cm91s3s/HIw/Ymc/MvGd2dua9n2NWVBVjjDHGGICoUAdgjDHGmPBhiYExxhhjKlliYIwxxphKlhgYY4wxppIlBsYYY4ypZImBMcYYYypVmxiISG8RURF5uRHiaXBNPX7TPInIKyKSLyKtvKaNc8/lB2u4jjkisllE4oIWaJBE6udWRK529+vqWi6nIrIoOFE1rroeg6ZERLaKyNZQx1FXDV5j4PWmq4j8NUAZzwXuvw21rDF1EY43IBEZA1wJ/FlVD9RjVfcDfYDbarn9B91jMq4e2za10NRvJN5qm8Ca8BPspoTbRKRXCJY1pin7E1AEPFuflajqSuAT4F4RadkQgTWibcBg4J5QB9LA3sXZr3dDHYgxgQQzMdgExAOPNvKyxjRZIjIAOAN4R1UPNcAqXwGSgCsaYF2NRlVLVTVLVfNCHUtDUtVCd78KQx2LMYHUOTEQkSgR+adbZTRbRFr4FHkHWAFcLiKptVx9fZYNyK02fktEdopIsYikicj5PmVudPfpgQDr6CIipSKyxmtaZdWriFwlIitE5JDbRvyiiHQJsK72IvKYiKxzyxeKyGcicpafspXtciIyQUQWueXVq4y607uJyGvu9g+JSLqIHHFjEJE4EblVROaKyPciUiIiu0XkfyJyToCYt7p/bUTk7+7/Sz3Vhu627xeRr0Rku4gcFpFcEXlDRIYEeE9URF4WkaNEZKaI7BKRfSLyqYgMc8sli8h0Eclz37tlIjI+QIwxInKLiHwtIkUictB9T24VkSivcg8C37kvr/Jqxjqi/VNEznaP0073OG0WkcdFJKm2x6ga1wICvF2Dsp7tJbjHTUVkmvc+Au8DxcB1NVzXVsBz7i/0PiZeZRZ5v/ZZ3m/7sdcxaeUetx/c47hJRO4SEfEp77eJxz1P1J1/o4iscc+HHe750TZAXGe75+QB9xx/T0QGea+vBsfmTbdsf5/pr7jTP/OZ3tp93xcHOj7iVrsDvYBePufgT/bdLd/R63NQIiIZInJNdbH7rMPzXrQVkadFZJt7DDNF5Dbv98I9RioiC6tY3xp3P7u6MXvKPuCzP+P8LDvePZ/2uZ/Vj0RkcIDtdHXP763iXFcKxLn3jPZT1vt6WeNtBNhura+TVawrXkTudo/ZQTeeL0TkMj9lva+N1d67fJa9XEQWishet/w6EblPROJrEmdMbXbKa6MJwOvAJcA04DZVrfAppsAdwGfAE8C4WmyiPssG0gv4FtgCvAa0B34GvC8iZ6iq52R+HfgrcJ2IPKKq5T7ruRbnuP3bzzZ+B5yFc1H/BDgJuAYYJyLHqWqBp6A4zSSLgN7AF275VsD5wCcicqOqPu9nG5OACcDHwHPufnlrBywB9gIv4XxbvAx4XUS6q+rjXmXbA/90y88HCoCuwAXAXBG5QVX/4yeGOGCBu/ynONXenhvsKcDdOBeHWcB+oL8b94UicqKqrvKzzt7AN8A64GX39cXAIhE5wT0+RTjHtj0wBfhYRAao6g+elYhILPABcDawHngD58Y4HvgXcBxO+z04xz8J+A2wCnjPK56VXut8AHgQ2A18COQDw3HO0XNF5ARVLarFMarKGUA58HUNyiIi7YA5wInAPar6Z+/5qlosIunA8SLStgbfVP8BXAScilPbsLUmcdRQLDAP6IZz/pa52/ozkAA8VIt1/RXnPf4A5/iOB24A+gGneRcUkSn8eB68A+QBY4GlOO97TX2Gc96dDmz0mn66++9YEUlQ1WL39ak414qfJAw+tuLs92/d1//wmrfSp2wS8BVwGJiJU6s6GXhRRCpU9ZVa7Esc8D93nW+5ry/FuR4MBH4FoKpZblIw3v2sbfBeiYiMBYYBs1Q1T0Q8n6GrgM9xPmPe++rtfGAiP17LhgDnAmNEZIiq7vTaTh/gS5xzZwHwJtDD3f/zRORSVf3Qz37WeBtVqOt18ifE6QQ8D+e8yMK5d7bEuTa+LSIjVPUPfhat6b3Ls50Xce47OTjX4L3A8cAfgdNF5ExVLasyWFWt8g/nAq3Ay+7r9jhvUAVwl5/yV7vlH3Fff+i+vtCrzDh32n8batkaxK/AAz7zznanz/WZ/rQ7/Xyf6eK+OQeAtl7TH3TLHwZG+izzpDvvBZ/pi9xjOMVnehLOBeEQ0NnPsakAJgTYV89+vgNEeU3vg3NTOwz09ZoeD6T4WU9bYK27TAufeVvdbfwPaOVn2U5Aaz/Tj8FJEj6u4v2512fe/7nTd+N8qL336Up33pM+y3jei38B0V7To4EX3HkTA53ffuIe785fAiQFOF99Y6jyGFVxrrbCuVmuCTB/nLveB93XvYBM9339eRXr9ZyD59YwDs8xHBdg/iJAA8zzHJOrAxyTud7nlHu+7HX/Yqt7X3CSRgV+AHp6TY8BFrvzjvWa3hrYA5QAx/is689e517vGhyXvm7ZGV7TBrrTPnX/Pd3PcT+5hsdnaxXb9sT5H5/zeoh7zmTW4jzzvBdfAvFe09sDm915p3hNn+ROe8LPujzvx5mBztMqzpEy7+PlznvMnfd7n+nz8H+NGOuuZxeQWJ9tVHG86nqd3Ooz7R5+/AzE+HwGPO/JWD+fgdrcuzz7PdtPTA+6835T7T7X4KB4gnsZ50K0jiouRBx5c/ecuOs8B4OaJwY1XrYG8W/F6wPlNf97YKfPtKHuMh8EeDNeDHDAX/Cz/rY4F71DuB9CnJvkTy4wPstMdOff4ufYvFvFvno+CH38zPPE+ECg5X3K347PBcLrhFd8LrI1XOccnG9t/m4A3/m+P0BPd94BfJINnBt9KbDQa1oUzgUiD68Pntf8JJzE6h1/53eAmN915w8NMH8FkN8QxwgY4C73aYD5nnP/QWAEkAsU4nPh87PcXe5yN9UwDs+5Mi7A/EXUPTHo52eZV9x5w6p7X/jxRnS9n/Vc48671WvaL/DzmXXnJeIkDUoNEgN3me+AnYC4r29xlz8e57P3qFfZ1TjJsPf5XtXx2VrFdj2fgzZ+5n3uzk+s4T543ouT/czzxPeS17QY91zbyU8TiSTgIE6fMPF3nlZzjhxxDcf5EqPATK9pKe60772Ppdf819z5v6zrNur6R9XXya0+0zbiXH8G+VnPdb7nKXW7d63AuS4m+Skf7b6H31a3X7VpShiIU/XWCjhHVauqHqukqpki8gIw1f17pqYbrM+yfqzUI5sFALKBE3y2myFOu+A5ItJDVbPdWVPdf58LsI3PfSeoaqGIrMSpPhqMUxvg2V5b8d/unOz+668d7NsA2/b4QVW/8zN9EU7b8UjviSIyFLgTpwmgK06VrrfuftZVjHPR80tEzgNuAlKBjhzZZNUR5+btzd/7k+v+u0FV93nPUNVyEdmBc9HwGIDzrWcjcJ/8tNna4xD+j2sgJ+B80CaLyGQ/8+OAZBHpoKq7vKZXeYwC6OD+u6eacifhXJD24VyQqqsO3+3+27GW8TS0QlXd5Ge65/PVrhbrSqvhejzn+5e+hVV1v/vZHFeL7S7AaU4cgXMRPg3IU9Wv3Sab08HpE4NTxf6pqpbWYv1V2ahHNlnBT/d7fw3XVYZTC+Zrkftv5XVCVctE5Hmc4a+X4jTLgFNr1wKYru6dp5Zq+x5+EeBYLsBJAEcCr9ZxG1Wq43XSe/nWOM1c21Q1y0+RBe6/I/3Mq9G9S5yRR8fg3Px/G+D6V0INrn+1SQw8F92VwPJaLAfOCXUFTmeU1xpxWW97A0wvw38nzGdwToLr3W13AS7EeZMC3Zx3BJi+3f3X0zHKcwM40/0LJLGKdQVS0xgQkeNxTkhPO+gcnLbwCpwL30ScajRf+YEuBCLyG5x20j047XE/4HyrUJz25GMCrPOItm/3guR3nqsMp93aw3Nc+/NjBzp//B3XQDrgHJ+q1udZp3diEPAYVcEzCsH3ouNrJE4V+RKctsrqeDoGN8Qoh/qo6jMIzjea+qzL33o853ugz0Wg6YF8hpMYnC4iq3CamuZ6zfu9OB0gT8NpeqzRF6gaasjjtzPAzeaI64RrOnAvcCM/JgZTcWqPX6rFdr0dsT9en3l/72GgESqe6Ud0BK7FNgKqx3XSW4Pug8v33tUO55xLpvrrVZVqkxh8gNOZ61HgM7cDw65qlgFAVXeIyOM4nWzuxrlh1Eh9lq2n2TgXjetE5GGq7nTo0TnAdM+ohEKff3+jqk/VMq7qbjY1jQHgPpybxnhVXeRdWETuwTnhaxyDiMTgVENvB0apz1AztxNhMHn27V1VvaQB1xmlqu1ruVxdvkHlu/92qLKU0wemE06tzBwRuUirHtroWV9+FWVqowKc91uP7MTk78IWSp5v2IE+F4GmB+L5ZncGP3Yu/cxr3j04ycLpPuXDTUcRifaTHPi7TqCq20RkDnCxiAzC2e9hwNvq1ak6SDyx+B3dhfMN3rtcQ6vrddJbY+yDZ9kVqjqqHuup3XBFVX0Mp+f9SJze4rX5UD2BUzX8O35a/RvsZevErbL6D04V0QU4NQf7cUYtBHKq7wT328MInKrlde5kT4/zkxsqXi89xf/Qq3Huvyu8pvUDdvue7K4j9qUGOuLcGJb4SQoSgXqdrDWQhdsD1x2dUBOeC2Ogbw9fA+3cqsRgy8Pp8TywmnKqqjfj1MycBXwkXo9O9mOQ+69vL/dAqjsmnqaOHn7mNdjw4gbiOd9P8p3hnpMjarMyVd2O0+HzZJzRQfBjYvAVTlXt6Tg1Bnv46eetKuXU7ht/fcXgdNzzNc7911/cnqbcG/mxWdXfF6Xqzp/aqnwP3S8fvjzDlmtbk11T9b5Ouk2hm4Hu4jPc1VXvfVDV/UAGMFREavtF5idq/RwDVf0HcDNOB73PRaRbDZc7iNPLvAW1rOaoz7L1NB3nJH8ap8PKG75t3T6uFBHfNqIHcaqR3lTVEgBVTcMZoniJiFzrb0UicrSIdKpDzNHAX+Sn4/U9j8UtA7wfJb0VaC8iw322fR1OR8vaysdpNhjtXnQ964vFGe4T1DZu99vrv3Cy76fkyGdreMZCez9PwdP5rGeA1T7p/vu8v3NdnHH5x9cvcofb9LAY59tcvxqU/x1OD+vxwDwRaROg6PE47Y5raxiKpyYw0DHxNKXd4D1RRE4HLq/hNhrL+zjfpH4uIsf4zLuPutVwLMAZZvYbnHb/bAC31mYpzvDgo4BFeuQw7kB24fRVOeKcDaLHvMe1uzeT+9yX/poHPgM24AxFvAxYrz5D5VzVnT+1oqo5ODXFvflxWCcAInIcTlPzHoL3NMmtNMx18kWcqv7HRaQyaRKRjjj3N0+Z+vg7Tr+nF8X/M1baiUi1X9Dq9BwDVX1ORIpxhn8tFpHT1GsseRVexnljj67DZuuzbJ2o6g8i8hFO3wKouhkBnLGyX4mIZ6z0Se7fVpxmEG9X4FxgXhCR23DG8O/FqREZjlNNdwK1r/5djTNWP11EPuXH5xgk4QzP2exV9h84J/aXbsyFON/4TsIZJz2pNhtW1QoReQpnX9eIyPs4J+l4nKrHhfyYGQfLH3H6MdwEXCAiC3Aer9sJp+/BiThtpZluzPtF5BvgZBF5HefCVw7MUdXVqvqZiNyNcwPeKCJzcXqmJ+KM0jkVp2PbBBrGLJwOXmfj9Paukqr+wf0sPgTMF5EJqlrZeVFEBuJcoGvTQWwhTnPBY+I8YGqPu61H3Pkv4XTEuse92Wbi9EE6B+fifGkNtxN0qlokIr/C6bm+xOuzORbnPPkc5z2s6Q0cnBvkrTjn1Gw/88Z5/b826xyD8wyTxTg1D6tU9YNarKM28nDaxde6TQSxOJ/3rsAzqrrYdwFVVRF5DufmA84XJ3/W43zmpohIKU7veQVeU9Xv6xjvTTg1Mo+L8wC4NH58jkEFcE01X9rqo6Guk0/gfEYmAqvca0lLnH3oBPxVVY/oJFsbqvqiOA98ugXYLCLzcPp5tcf5cnsKzuf3pupWVN1wjN4EGM6F8+2gFOfG11d/OkzkkQDr8wz5O2IoSX2WrUv87vxFBBh65c73DB1cVkWZB90y49x98DyHoMB9E7oGWK418AcgHaeZ4hDOTecjnKq6Vl5lPcfm6iriUHd/uuHUDOTjNGEsB64IsMz5ONXl+3ASk0/dk8fv9qh+WFUMTo/5THd/tuNclHvx41Cz3rV4fxTnm5e/eX5jwcnKr8S52Hqe37AN5wb+B6CHT/l+OH1oduFcZPzt90k4z4fIdddX4L7PfwdSa3OMqjlf43D6tnzjZ944AgwDw7lRq/ted/Sa/qg7fUQt4/iF13ms+HxGcGoM57rnzX73vDu1LucNfoZHBjov/J1DNTw+5+B01jyIk+i8j9PE4nlWyhHDu6o4Nkk4yaMCk33mncCP16jBfpYNdHxa4fw2Rg5Ozd5P9p2qPwcBj0lVnxucmsxpOJ+NEpymztvwGnroZ9l27r4fAjpUUW4MzuevkB8/U+OqOgbV7StOs+6zOInGYZxasPeAMTU9zjU5ngHKN8h1Eqdj8R9wau8Ouev7ErjcT1m/nwGv+YsIPGz4fH58GNthnOvwt8Aj+Bku6fvnGYtrAnCHEz6AM276hWrKHNE5pTGJ82jVz1V1XKhiMPXndmh6FKcDZ03bqP2tJx7ngVzrVPWMhoovUrjVuVuAOFXtWl35SCHurziqau86LDsOp0bpv6p6ZTXFTRMV7F9XbNLcsac34XzrfDPE4Zjm40mc6r+H67mem3F6Qf+/ekfUhIlIkvj8uqQ449Xuw2lmsV86rLnfu/8+HdIoTFDVqY9BpHMf0DMKZzRCZ+AOdTpAGhN06vy+wZU4z6dvpaoH6riqEuA6rf4BSJHueJxn0X+KU8Wb6E4bgfOQmAdDFlkTICJH41RNj8ZpkvlQVb8JbVQmmCwx8G8yTs/bHTidzp6surgxDUudzl9HdACr5TqebaBwmrr1OO2tJ+L8gE4MTlv+UziPMG6o5ztEqtE4TVtFwAycjm0mglkfA2OMMcZUsj4GxhhjjKlkiYExxhhjKlliYIwxxphKlhgYY4wxppIlBsYYY4ypZImBMcYYYypZYmCMMcaYSpYYGGOMMaaSPfkwDHTs2FF79+4d6jCMMaZJSU9P36mqyaGOI9JYYhAGevfuTVpaWqjDMMaYJkVEvg91DJHImhKMMcYYU8kSA2OMMcZUssTAGGOMMZUsMTDGGGNMJUsMjDHGGFPJEgNjjDHGVLLEwBhjjDGVLDEwxjSqQ4fLmZWeQ2l5RahDMcb4YYlBACIyQUTWi8gmEbnbz/wnRWSl+7dBRPZ6zfuriGSIyDoReUpEpHGjNyZ8vbp0K/9vxirunrUGVQ11OMYYH/bkQz9EJBqYBpwJ5ADLRGSOqmZ6yqjq77zK/xoY6f5/LHAiMNyd/SVwKrCoUYI3JswtyMonLiaKWctz6N6uBbefOSDUIRljvFhi4N+xwCZV3QIgIm8BE4HMAOUvBx5w/69AAhAHCBAL7AhqtMY0EYWHSkn7fg83ntKXnftLeOqzjXRPSuBnY3qGOjRjjMsSA/+6A9ler3OA4/wVFJFeQB9gAYCqLhWRhUAeTmLwtKquC264xjQNX2wsoLxCOX1wJ4anJLG9qIQ/vLuWTm0SGD+wU6jDM8ZgfQwawhRgpqqWA4hIP2AwkIKTYJwmIif7LiQiU0UkTUTSCgoKGjVgY0JlQVY+7VrGMqJHO2Kjo3jm56MY1KU1v3p9OWu3FYY6PGMMlhgEsg3o4fU6xZ3mzxTgTa/XFwNfq+p+Vd0PfAyc4LuQqk5X1VRVTU1Otl8NNZGvvEJZtL6AUwckEx3l9MdNjI/hpavH0K5lHNe8vIzs3QdDHKUxxhID/5YB/UWkj4jE4dz85/gWEpFBQDtgqdfkH4BTRSRGRGJxOh5aU4Jp9lbl7GX3gcOMH/TTJoNObRJ4+ZoxlJSWc/VL37L34OEQRWiMAUsM/FLVMuBWYB7OTf0dVc0QkYdF5EKvolOAt/SnY65mApuBNcAqYJWqftBIoRsTthZm5RMlcOqAI2vI+nduzfRfppK9+xBTX02nuLQ8BBE2nvIKZU1OIQdKykIdijFHEBtHHHqpqamalpYW6jCMCarznvqClnHRzLhpbMAyc1blctubKzhveFf+NWUkUVGR9QiQLQX7mZmew+zl29heVEyruGjOPborl43pQWqvdtgjT2pHRNJVNTXUcUQaG5VgjAm6HUXFZOQW8fsJA6ssd+Ex3cjbe4jHPs6ie1IL/nDu4EaKMHj2l5Tx0epcZqTlkPb9nspak9vPHEDa97v5aHUeM9Jz6N2hJZNGp3Dp6BS6tm0R6rBNM2aJgTEm6BZm5QNw2qDqhyROPaUv2/YeYvriLXRrm8DVJ/YJdngNrqJC+ea73cxIz+bjNds5VFpO3+RW3DVhEJeM6k7nNgkAXDamBw9cMJSP125nRlo2T3y6gb/N38BJ/TpyWWoPzhzSmYTY6BDvjWluLDEwxgTdgqx8urVNYGDn1tWWFREeuGAoeYXFPPRhJl3atmDCsC6NEGX95ew5yKz0bcxcnk327kMkxsdw0chuTBrdg1E9k/w2FbSKj2HS6BQmjU7h+10HmJWew6zl2/j1mytokxDDxBHdmZyawtHd21pTg2kU1scgDFgfAxPJSsrKGfnwfC4e2Z0/XXx0jZc7dLicy5//mnV5Rbxxw/GM7tUuiFHWXXFpOZ+s3c6M9GyWbN6FKow9qgOTU1OYMLQrLeJq/42/okJZsnkXM9Kz+WTtdkrKKhjYuTWTU1O4aGR3OibGB2FPmh7rYxAclhiEAUsMTCT7YmMBV77wLS9clcrpgzvXatld+0u49NklFB4qZdbNY+mbnBikKGtHVVmRvZcZaTl8uCqXfSVlpLRr4fQRGJVCj/YtG2xbhYdK+dDto7Ayey8xUcL4QZ2YPDqF8YM6ERvdfAeXWWIQHJYYhAFLDEwke+iDDN745gdW3n9Wnb49b915gEueXUJifAyzbxkb0m/L+UXFzF6xjZnpOWzK309CbBTnDuvKpNQUju/TIeijKDbu2OeMalixjYJ9JXRMjOOiEd2ZnNqDgV2qb6aJNJYYBIclBmHAEgMTycY9vpDeHVvx8jXH1nkdy3/YwxXPf83ALm1484bjaBnXeN2jDpdV8Nm6HcxIz+HzDc5vPYzu1Y7Jo1M4b3hXWifENlosHmXlFXy+oYAZaTl8lrWD0nJleEpbJo9O4cJjutO2ZePHFAqWGASHJQZhwBIDE6m2FOzntL99zh8nDuXKE3rXa12fZmznpv+mc9qgTjz3i9HEBLkKPSO3kBlpOby/cht7DpbSuU08l4xyOgkeFSZNGuA0t7y/MpcZ6TmsyysiMT6G1647lpE9w7NPRkOyxCA4LDEIA5YYmEj1ny+28MhH6/jyrvGktKt/u/urS7dy//sZ/OL4nvxx4rAG76W/+8Bh3l+5jRlpOWTmFREXHcWZQzozKTWFU/r/+BsP4WrttkJueX05B0rKmH3LWHp1aBXqkILKEoPgsOGKxpigWZCVz4DOiQ2SFAD88oTebNtziH8v3kL3pJbcPO6oeq+zrLyCxRudavn/rXOq5Y/u3paHLhzKxBHdSGoZ1wCRN45h3dvy8jVjuPTZJVz90jJm3TyW9q2aTvwmPFhiYIwJin3FpXz73W6uO7lhH1B014RB5BYW85dPsuiWlMDEEd3rtJ5N+fuZkZ7Nu8u3kb+vhA6t4vjlCb2ZNDqFwV3bNGjMjalvciL/uSqVK57/hutfWcYbNxxvD0kytWKJgTEmKL7cuJOyCuW0gdU/7bA2oqKEJyYPZ0dRMXfMWEVy63jGHtWxRssWFZfy4ao8ZqRns+KHvURHCeMHdmJyagrjB3YiLiYyhv6N7tWef04Zwc2vL+c3b63gmZ+PDvtmEBM+LDEwxgTFgqx82iTEBOXBRPEx0Tx/ZSqXPreEG19LZ+ZNYwMO16uoUJZu2cWMtGw+ydhOcWkFAzoncu+5g5k4shudWic0eHzhYMKwrvzfeUN4+MNM/vhhJg9cMMSenGhqxBIDY0yDq6hQFq4v4JQByUEbPdC2ZSwvXzOGi59ZwjUvfcu7vzqx8jcIALJ3H2RGeg6z0nPYtvcQbRKcRw9PHt2D4SnN4/HC157Uh9y9h/jPl9/RPakFN5zSN9QhmSbAEgNjTINbm1vIzv0lNfrRpPpIadeSl64ew8/+vZSrX1rGK9eMYfHGncxMz+brLbsRgZP6deSucwZxVjP9QaI/nDuYvMJi/jR3HV2TEjh/eLdQh2TCnCUGxpgGtyArH3F/XjjYhnVvyzO/GM21Ly/j2Ec/A6B3h5bccdYALhmVQrek5v0TxlFRwt8uO4b8fcXc/vYqkhPjOa5vh1CHZcKYJQbGmAa3MCufET2S6NBIjy8+dUAy/5wygiWbd3HRiO6M6d2uWTQV1FRCbDTP/zKVS55dwg2vpjH7lrH069T8HqFsaiYyuuAaY8JGwb4SVuUUNvhohOqcP7wbj158NMf2aW9JgR9JLeN45ZpjiYuJ5qoXl5FfVBzqkEyYssTAGNOgFq3PB2B8kPsXmNrr0d7pk7Hn4GGufWUZB0rKQh2SCUOWGAQgIhNEZL2IbBKRu/3Mf1JEVrp/G0Rkr9e8niLyqYisE5FMEendmLEbE0oL1+fTuU08Q7s13YcERbKjU9oy7YpRrMvbxy2vL6e0vCLUIZkwY4mBHyISDUwDzgGGAJeLyBDvMqr6O1UdoaojgH8Bs71mvwo8rqqDgWOB/MaJ3JjQKi2v4IsNOxk/sJNV54ex8YM68chFw/h8QwH3vbsW+80c480SA/+OBTap6hZVPQy8BUysovzlwJsAbgIRo6rzAVR1v6oeDHbAxoSDZVt3s6+kLOgxII4yAAAgAElEQVTDFE39XX5sT359Wj/eTsvmXws2hTocE0YsMfCvO5Dt9TrHnXYEEekF9AEWuJMGAHtFZLaIrBCRx90aCGMi3oJ1+cRFR3Fiv5o9otiE1u1nDuCSUd35+/wNzEzPCXU4JkxYYlB/U4CZqlruvo4BTgbuAMYAfYGrfRcSkakikiYiaQUFBY0Vq6mBigplyaad/PN/G1nxwx6rZq2FBevzOa5ve1rF20jopkBE+PMlwzmpX0funrWaLzbatchYYhDINqCH1+sUd5o/U3CbEVw5wEq3GaIMeA8Y5buQqk5X1VRVTU1ODv5DYEz1sncf5O/zN3DyXxdyxX++4cn/beDiZ5Zw1pOL+ffnm8nfZ8O7qvL9rgNsKThgzQhNTFxMFM/8YhT9OiVy83+Xk5lbFOqQTIhZYuDfMqC/iPQRkTicm/8c30IiMghoByz1WTZJRDx3+9OAzCDHa+ro4OEyZqXnMGX6Uk7+60L+tWAjfZNb8c8pI1h27xk8dsnRtE6I4bGPszjhsQVc9/IyPlmbx+Ey68nta0GW08fWEoOmp01CLC9dM4bE+BiueflbcvceCnVIJoTEqkn9E5FzgX8A0cCLqvonEXkYSFPVOW6ZB4EEVb3bZ9kzgb8BAqQDU91OjH6lpqZqWlpacHbEHEFVSf9+DzPScvhoTR77S8ro1aElk0alcMnoFLr7eYTupvz9zEzPYfbyHPL3ldC+VRwTR3Rj8ugeDLFheQBc+cI3bNt7iAX/b1yoQzF1lLW9iMnPLqVrUgIzbhpL2xaxoQ6pSiKSrqqpoY4j0lhiEAYsMWgc2wuLmbXc+bW9LTsP0DIumnOP7srk0Sk1flpeWXkFX2zaycy0HOZn7uBweQVDu7Vh8ugUJo7oTrtWcY2wJ+HnQEkZIx+ezy9P6MV95w+pfgETtpZs2slVL33L6F7teOXaY4mPCd++05YYBIclBmHAEoPgKSkrZ37mDmak5fDFxgIqFI7t3Z5JqSmcd3TXenWS23PgMHNW5TIjPZu124qIi47ijCGdmDy6Byf37xi0nxsOR59mbGfqa+m8cf1xjLURCU3euyty+N3bq5g4ohtPXjaCqKjwfCaFJQbBYV2HTcRRVdZuK2JGejbvr8yl8FApXdsmcMu4fkwanULvjq0aZDvtWsVx1djeXDW2N+vyipiRlsN7K7cxd812OrWO55JRKUxOTeGo5MQG2V44W7g+n8T4GFJ7tw91KKYBXDwyhdy9xTw+bz3dklpw14RBoQ7JNCJLDEzE2LW/hHdXbGNmeg5Z2/cRFxPF2UO7MHl0Cif260h0EL/1DO7ahvsvGMLd5wxiQVY+M9Ozef6LLTz3+WZG9UxicmoPzh/eldYJ4d1mWxeqysKsAk7u35G4mOZTSxLpbhl3FNv2HuLZRZvpntSCXxzfK9QhmUZiiYFp0krLK1i0voAZadksyMqnrEI5pkcSj1w0jAuGd6Nty8a9EcfFRDFhWBcmDOtC/r5i3luxjRlpOdwzew0PfZDBOcO6Mm5gMnFBaGY4rm8H2oegj0NmXhHbi4rtR5MijIjw8IVD2VFYzP3vr6VzmwTOHNI51GGZRmB9DMKA9TGovQ079jEjLZt3V2xj5/7DdEyM55JR3Zk0OoUBncPrd+ZVlVU5hcxIy2bOqlz2FQfnF+2OSm7FR7edTEJs43YWe3rBRp74dAPf3ns6nVonNOq2TfAdPFzGlOlfk5FbxO/PHsgNJ/cNmz4H1scgOCwxCAOWGNRM4cFS5qzOZWZaNqtyComJEk4f7HT2O3VgMrFNoLNfcWk5W3cdaPD1rt++j9+8tZKbxx3V6O3BlzzzFWUVypxbT2rU7ZrGs6+4lLtmrWbumu2cMbgTT0w+hqSWoR+BY4lBcFhTgglr5RXKV5t2MiM9h3kZ2zlcVsGgLq35v/OHcNGIbnRIjA91iLWSEBvNoC4N/9yDQV3asGTTLqYv3sI5w7owPCWpwbfhz+4Dh1mRvZffnN6/UbZnQqN1QizTrhjFK0u28qe56zjvqS+Z9vNRjOjROOeZaVyWGJiwtHXnAWam5zBreQ55hcW0bRHL5WN6MDm1B0O7tbGf9PXj3vMH8/mGAu6csZo5vz6xUcafL1qfj6o97bA5EBGuPrEPI3q241evL2fyc0u499zBXDW2t30eI4wlBiZsHCgp46M1ecxMy+HbrbuJEjhlQDL3nTeEM4Z0CusHrYSDNgmxPHrJMK59OY1pCzZx+1kDg77NBVn5dEyMZ1i3tkHflgkPI3ok8dFtJ3HHjFU8+EEm327dzZ8vHU6bCBxx01xZYmBCSlX59rvdzEjPYe6aPA4eLqdvx1b8fsJALhmZQpe21pmtNk4b1JlLRnbnmUWbOXtYF4YG8YZdVl7B4g0FnD20S9h0RjONI6llHM//MpXnv9jCXz5ZT2au07QQzPPNNB5LDExI5O49xKz0HGYuz+H7XQdpFRfNhcd0Y3JqCqN6trOqyXq4/4IhfLFpJ3fOWM37t54YtE6Z6d/voai4zJoRmikRYeopRzGqZztufWMFFz+zhIcuHMqUMT3s89vEWWJgGk1xaTnzMrYzMz2HLzftRBVO6NuB207rzzlHd6FlnJ2ODSGpZRyPXDSMG19L59lFm7ktSB0DF6zPJzZaOKm/PQK5OUvt3Z6PbjuJ3769kntmr+Hb73bzyEXD6vW4cRNa9s6ZRvPrN1cwP3MH3ZNa8OvT+jN5dAo92rcMdVgR6eyhXbjgmG78a8FGzhraOSgjIRZm5TOmd/uIfJqjqZ0OifG8fM2xTFu4iX/8bwNrthXyzM9Hhd0zRUzNhP/AbxMRyiuULzfuZPLoFL74/XhuP3OAJQVB9tCFQ2mTEMudM1ZTVl7RoOvO2XOQDTv2WzOCqRQdJdx2en/+e91x7D1YysSnv2JWek6owzJ1YImBaRRbdx3gUGk5Y/q0t45qjaR9qzgenjiMNdsKmf7FlgZd98KsfAB7DLI5wth+HZl720kMT2nL/5uxirtmrqa4tDzUYZlasMTANIrM3CIAhnZr+CptE9h5w7tyzrAu/GP+Rjbl72uw9S7IyqdXh5b0baBfqjSRpVObBF6//jhuHd+Pt9OyuWjaV2wp2B/qsEwNWWJgGkVGbhGx0UL/Ttbm2NgenjiMVvHR3DlzNeUV9X8E+qHD5SzZvIvxAztZ73MTUEx0FHecPZCXrhnDjqJiLnz6Kz5cnRvqsEwNWGJgGkVmXhH9OrW2n+UNgeTW8Tx44VBW/LCXF7/8rt7rW7plJyVlFda/wNTI+IGd+Oi2kxnQOZFb31jBA++vpaTMmhbCmV2lTaPIzC1iSFdrRgiVC4/pxhmDO/PEp+vrXaW7ICuflnHRHNe3fQNFZyJdt6QWvH3jCdxwch9eWfo9k59bSvbug6EOywRgiUEAIjJBRNaLyCYRudvP/CdFZKX7t0FE9vrMbyMiOSLydONFHZ7y9xWzc3+J9S8IIRHhTxcPIz4mirtmraaijk0KqsqCdfmc1K+jPaLa1EpsdBT3njeEf185mu92HuC8p77g04ztoQ7L+GGJgR8iEg1MA84BhgCXi8gQ7zKq+jtVHaGqI4B/AbN9VvNHYHFjxBvuMtyOh0MsMQipzm0S+L/zh7Bs6x5eXbq1TutYv2MfuYXF1oxg6uzsoV346Ncn06tDK6a+ls7f528IdUjGhyUG/h0LbFLVLap6GHgLmFhF+cuBNz0vRGQ00Bn4NKhRNhGeEQmDrSkh5CaNTmHcwGT+8sl6fthV+6rcBTZM0TSAnh1aMvPmE7jy+F4MtIcghR1LDPzrDmR7vc5xpx1BRHoBfYAF7uso4G/AHUGOscnIzCuiR/sWtG1hT8gLNRHh0YuPJjpK6tSksDArn6Hd2tC5jf24lamf+Jho/njRMM4b3jXUoRgflhjU3xRgpqp6utneAsxV1Sof+SUiU0UkTUTSCgoKgh5kKK2zjodhpVtSC+49bzBLt+zijW9/qPFyew8eJv37PdaMYEyEs8TAv21AD6/XKe40f6bg1YwAnADcKiJbgSeAX4rIn30XUtXpqpqqqqnJyckNE3UYOlBSxne7DjCkq/0caziZMqYHJ/XryGNz15Gzp2ZNCp9vKKBCrRnBmEhniYF/y4D+ItJHROJwbv5zfAuJyCCgHbDUM01Vf66qPVW1N05zwquqesSohuYia3sRqtbxMNyICI9dcjQK3DN7DarVNykszMqnfas4jklJCn6AxpiQscTAD1UtA24F5gHrgHdUNUNEHhaRC72KTgHe0ppcVZspexRy+OrRviX3nDOILzbu5J207CrLllcon28oYNyAZKLtty6MiWj2s8sBqOpcYK7PtPt9Xj9YzTpeBl5u4NCalMy8IpJaxtK1rXVWC0c/P64XH63J45EP13HKgGS6tm3ht9zK7D3sOVhqzQjGNANWY2CCKsPteGjP1A9PUVHCXy4dTlmF8ocqmhQWZOUTHSWcMiBy+8MYYxyWGJigKSuvIGv7PhuREOZ6dWjFnWcPZOH6AmYv99/HdkFWAaN7tbMhp8Y0A5YYmKDZsvMAh8sqGNrdEoNwd/XY3qT2asdDH2SQX1T8k3l5hYdYl1dkwxSNaSYsMTBBk5FbCGBDFZuAqCjhL5OGU1JWwb3vrf1Jk8LCLOc5G5YYGNM8WGJggiYzt4i4mCj6JrcKdSimBo5KTuT2MwcwP3MHc1blVk5fkLWDlHYt6N8pMYTRGWMaS8QnBiKSLiK/EpF2oY6lucnMK2JQl9bERkf8aRYxrj+5L8f0SOLBORkU7CuhuLScrzbt4rRBnawDqTHNRHO4Yv8M6AYsE5G3RORssStc0KkqmfYo5CYnOkp4YtJwDpSU88CctXy9ZReHSsttmKIxzUjEJwaquklV7wUGAG8ALwLfi8hDItI+tNFFrrzCYvYcLLUnHjZB/Tu35jdn9Gfumu08OncdCbFRnNC3Q6jDMsY0kohPDABEZDjOLx4+DswCJgNFuL+IaBqe54mHVmPQNE09pS/Durdhw479nHhURxJio0MdkjGmkUR8YiAi6cCTOL9/MFxVb1PVb1T1b8CW0EYXuTLzihCBQZYYNEmx0VE8PukYEmKj7GdxjWlmmsMjkSerqt8EQFUvaexgmovM3CJ6d2hFYnxzOMUi0+CubVj+f2fSwmoLjGlWIr7GALheRCp/Dk5E2onII6EMqDnIyCu0ZoQI0DIuxkYjGNPMNIfE4BxV3et5oap7gHNDGE/EKzxUSvbuQ9bx0BhjmqDmkBhEi0i854WItADiqyhv6ikrz+14aImBMcY0Oc2hAfh14DMRecl9fQ3wSgjjiXiZbmIw1JoSjDGmyYn4xEBV/yIiq4HT3Ul/VNV5oYwp0mXkFtExMY7k1lYxY4wxTU3EJwYAqvox8HGo42guMnOLGNKtrXVaM8aYJiji+xiIyPEiskxE9ovIYREpF5GiUMcVqQ6XVbAxf5+NSDDGmCYq4hMD4GngcmAj0AK4HpgW0ogi2Kb8/ZSWq3U8NMaYJqo5JAao6iYgWlXLVfUlYEJ1y4jIBBFZLyKbRORuP/OfFJGV7t8GEdnrTh8hIktFJENEVovIzxp+j8JXRm4hYI9CNsaYpqo59DE4KCJxwEoR+SuQRzUJkYhE49QqnAnk4Pwy4xxVzfSUUdXfeZX/NTDSsz3gl6q6UUS6AekiMs/7WQqRLDOviBax0fTp2CrUoRhjjKmD5lBjcCXOft4KHAB6AJdWs8yxwCZV3aKqh4G3gIlVlL8ceBNAVTeo6kb3/7lAPpBcrz1oQjJzixjUtTXRUdbx0BhjmqKITgzcb/6Pqmqxqhap6kOqervbtFCV7kC21+scd5q/bfQC+uDnlxpF5FggDthcpx1oYlSVzLwia0YwxpgmLKITA1UtB3q5TQnBMgWY6W6rkoh0BV4DrlHVCt+FRGSqiKSJSFpBQUEQw2s8OXsOsa+4zDoeGmNME9Yc+hhsAb4SkTk4TQkAqOrfq1hmG06Tg0eKO82fKcCvvCeISBvgI+BeVf3a30KqOh2YDpCamqrV7EOTkJHrPvGwW9sQR2KMMaaumkNisNn9iwJa13CZZUB/EemDkxBMAa7wLSQig4B2wFKvaXHAu8CrqjqzfqE3LZl5RUQJDOxc08NsjDEm3ER8YqCqD9VhmTIRuRWYB0QDL6pqhog8DKSp6hy36BTgLVX1/sZ/GXAK0EFErnanXa2qK+u8E01EZm4hfZMTaREXHepQjDHG1FHEJwYishA4oqpeVU+rajlVnQvM9Zl2v8/rB/0s91/gv3WJtanLzC0itXf7UIdhjDGmHiI+MQDu8Pp/As5QxbIQxRKx9hw4TG5hMUOt46ExxjRpEZ8YqGq6z6SvROTbkAQTwda5P7VsIxKMMaZpi/jEQES867ajgNGAdZtvYJ4RCfYMA2OMadoiPjEA0nH6GAhOE8J3wHUhjSgCZeYV0aVNAh0S40MdijHGmHqI+MRAVfuEOobmIDO3yJoRjDEmAkT0kw8BRORXIpLk9bqdiNwSypgiTXFpOZsK9lszgjHGRICITwyAG7x/2VBV9wA3hDCeiLNhxz7KK9RqDIwxJgI0h8QgWkQqf+rP/WGlYP52QrOTWfkoZEsMjDGmqYv4PgbAJ8DbIvJv9/WN7jTTQDLzikiMj6FHu5ahDsUYY0w9NYfE4C5gKnCz+3o+8J/QhRN5MnOLGNy1NVFRUn1hY4wxYa05JAYtgOdV9TmobEqIBw6GNKoIUVGhrMsrYtLolFCHYowxpgE0hz4Gn+EkBx4tgP+FKJaI8/3ugxw4XG4/tWyMMRGiOSQGCaq63/PC/b81hjcQT8dDG5FgjDGRoTkkBgdEZJTnhYiMBg6FMJ6IkpFbSEyU0L9zYqhDMcYY0wCaQx+D3wIzRCQX57HIXYApoQ0pcmTmFdGvUyLxMdGhDsUYY0wDiPjEQFWXicggYKA7aX0o44k0mblFnNS/Y6jDMMYY00CaQ1MCqloKZACdgeeAnNBGFBkK9pWQv6/EHoVsjDERJOITAxE5XkSeAr4H3gcWA4NCG1VkyMyzjofGGBNpIjYxEJFHRWQj8CdgNTASKFDVV9zfSzD1VPko5K42VNEYYyJFxCYGwPXADuBZ4DVV3QVoTRcWkQkisl5ENonI3X7mPykiK92/DSKy12veVSKy0f27qiF2Jhxl5hXRPakFbVvGhjoUY4wxDSSSOx92Bc4ELgf+ISILgRYiEqOqZVUt6D4dcZq7fA6wTETmqGqmp4yq/s6r/K9xaiQQkfbAA0AqTiKS7i4bcbUUmbmF1oxgjDERJmJrDFS1XFU/UdWrgKOA94AlwDYReaOaxY8FNqnqFlU9DLwFTKyi/OXAm+7/zwbmq+puNxmYD0yoz76Eo4OHy9iy84B1PDTGmAgTsYmBN1UtUdVZqnop0J/qf12xO5Dt9TrHnXYEEekF9AEW1HbZpixr+z5U7aeWjTEm0jSLxMBDRD5U1SJVfbUBVzsFmKmq5bWMZaqIpIlIWkFBQQOG0zjsUcjGGBOZmlViQM2/uW8Deni9TnGn+TOFH5sRarysqk5X1VRVTU1OTq5hWOEjM6+Iti1i6Z7UovrCxhhjmozmlhisqGG5ZUB/EekjInE4N/85voXcJyq2A5Z6TZ4HnCUi7USkHXCWOy2iZOQWMaRrG0Qk1KEYY4xpQBGbGIjInSKS4j1NVa+tybLuqIVbcW7o64B3VDVDRB4WkQu9ik4B3lJV9Vp2N/BHnORiGfCwOy1ilJVXkJVXZM0IxhgTgSJ5uGI3YKmIbMWp6p+hqjVuzFfVucBcn2n3+7x+MMCyLwIv1jLeJmPrrgOUlFXYiARjjIlAEVtj4D5noCdwH3A0sFpEPnEfPtQ6tNE1bRnW8dAYYyJWxCYGAOr4XFVvxukE+CTOzzDvCG1kTVtmbhFx0VH065QY6lCMMcY0sEhuSqgkIkfj9Af4GbATuCe0ETVtmXlFDOiSSGx0ROeVxhjTLEVsYiAi/XGSgSlAOc7TC89S1S0hDayJU1Uyc4s4fXCnUIdijDEmCCI2MQCygEXAz1R1rWeiiJwIbFfVzaEKrCnbUVTCrgOHreOhMcZEqEiuC/4E+K13UuAqAv4RgngiQmZeIQBDu9tPLRtjTCSK5MSgk6qu8Z3oTuvd+OFEBs+jkAd1sYEdxhgTiSI5MWhXxTx7jm8dZeYV0atDS1onxIY6FGOMMUEQyYnBMhG5wXeiiFwPpIcgnojgeRSyMcaYyBTJnQ9/C7wrIj/nx0QgFYgDLg5ZVE3YvuJSvt91kMmjU6ovbIwxpkmK2MRAVXcAY0VkPDDMnfyRqi4IYVhNWtb2fYA98dAYYyJZxCYGHqq6EFgY6jgigafj4ZCuNiLBGGMiVST3MTANLCO3kA6t4ujcJj7UoRhjjAkSSwxMjWW6P7UsIqEOxRhjTJBYYmBqpLS8gg3b99uIBGOMiXCWGJga2Vywn8PlFdbx0BhjIpwlBqZGMrY5HQ+HWmJgjDERzRIDUyOZeUUkxEbRp2NiqEMxxhgTRJYYmBrJzC1iYJc2REdZx0NjjIlklhgEICITRGS9iGwSkbsDlLlMRDJFJENE3vCa/ld32joReUqaeDd+VXVGJFjHQ2OMiXgR/4CjuhCRaGAacCaQg/O7C3NUNdOrTH/gHuBEVd0jIp3c6WOBE4HhbtEvgVOBRY23Bw1r295DFB4qtf4FxhjTDFiNgX/HAptUdYuqHgbeAib6lLkBmKaqewBUNd+drkACzm8yxAOxwI5GiTpIKp94aImBMcZEPEsM/OsOZHu9znGneRsADBCRr0TkaxGZAKCqS3EewZzn/s1T1XWNEHPQZOYVIQKDurQOdSjGGGOCzJoS6i4G6A+MA1KAxSJyNNARGOxOA5gvIier6hfeC4vIVGAqQM+ePRsr5jrJyC2ib8dWtIyz08UYYyKd1Rj4tw3o4fU6xZ3mLQeYo6qlqvodsAEnUbgY+FpV96vqfuBj4ATfDajqdFVNVdXU5OTkoOxEQ8nMLWJIN/vhJGOMaQ4sMfBvGdBfRPqISBwwBZjjU+Y9nNoCRKQjTtPCFuAH4FQRiRGRWJyOh022KaHwYCnb9h6yEQnGGNNMWGLgh6qWAbcC83Bu6u+oaoaIPCwiF7rF5gG7RCQTp0/Bnaq6C5gJbAbWAKuAVar6QaPvRAPJzLOOh8YY05xYo3EAqjoXmOsz7X6v/ytwu/vnXaYcuLExYmwMGbmFAFZjYIwxzYTVGJgqZeYV0al1PMmt40MdijHGmEZgiYGpktPx0GoLjDGmubDEwARUUlbOpvz91oxgjDHNiCUGJqCNO/ZTVqEMtaGKxhjTbFhiYAKyRyEbY0zzY4mBCSgzr4hWcdH0at8y1KEYY4xpJJYYmIAyc4sY3LUNUVFN+lejjTHG1IIlBsavigolM89GJBhjTHNjiYHxK3vPQfaXlNmIBGOMaWYsMTB+WcdDY4xpniwxMH5l5hURHSUM6Nw61KEYY4xpRJYYGL8ycovol5xIQmx0qEMxxhjTiCwxMH7Zo5CNMaZ5ssTAHGHX/hK2FxVbx0NjjGmGLDEwR8jMczoeDrUaA2OMaXYsMTBHWJW9F4DBVmNgjDHNjiUG5id2FBUzffEWjuvTnnat4kIdjjHGmEZmiYGppKrc++5aSsoq+POlw0MdjjHGmBCwxMBUmrMql/+t28EdZw2kT8dWoQ7HGGNMCFhiEICITBCR9SKySUTuDlDmMhHJFJEMEXnDa3pPEflURNa583s3Vtx1VbCvhAfmZDCiRxLXntQn1OEYY4wJkZhQBxCORCQamAacCeQAy0RkjqpmepXpD9wDnKiqe0Skk9cqXgX+pKrzRSQRqGjE8Ovk/vfXcrCknMcnDSfafk3RGGOaLasx8O9YYJOqblHVw8BbwESfMjcA01R1D4Cq5gOIyBAgRlXnu9P3q+rBxgu99j5ancfHa7fzmzP6098egWyMMc2aJQb+dQeyvV7nuNO8DQAGiMhXIvK1iEzwmr5XRGaLyAoRedytgQhLuw8c5v7313J097bceErfUIdjjDEmxKwpoe5igP7AOCAFWCwiR7vTTwZGAj8AbwNXAy94LywiU4GpAD179mysmI/w4JwMiopLeX3yccREW55ojDHNnd0J/NsG9PB6neJO85YDzFHVUlX9DtiAkyjkACvdZogy4D1glO8GVHW6qqaqampycnJQdqI6n2ZsZ86qXG4d359BXexhRsYYYywxCGQZ0F9E+ohIHDAFmONT5j2c2gJEpCNOE8IWd9kkEfHc7U8DMgkzew8e5t731jK4axtuGX9UqMMxxhgTJiwx8MP9pn8rMA9YB7yjqhki8rCIXOgWmwfsEpFMYCFwp6ruUtVy4A7gMxFZAwjwfOPvRdUe/jCTPQcO8/ik4cRaE4IxxhiX9TEIQFXnAnN9pt3v9X8Fbnf/fJedD4TtowMXZO1g9vJt/Pq0fgzr3jbU4RhjjAkj9lWxmSkqLuUPs9cyoHMit57WL9ThGGOMCTOWGDQzf/pwHfn7inl80jHEx4TtKEpjjDEhYolBM7J4QwFvp2Uz9ZSjOKZHUqjDMcYYE4YsMWgm9peUcc/sNfRNbsVvz+gf6nCMMcaEKet82Ew8NncduYWHmHnTCSTEWhOCMcYY/6zGoBlYsmknr3/zA9ee2IfRvdqHOhxjjDFhzBKDCHegpIy7Zq+md4eW3HHWwFCHY4wxJsxZU0KEe3zeerJ3H+LtqcfTIs6aEIwxxlTNagwi2Lff7eblJVu56oReHNe3Q6jDMcYY0wRYYhChDh0u5/czV9GjfQt+P2FQqMMxxhjTRFhTQoT6+/z1bN11kDeuP45W8fY2G2OMqRmrMYhAy3/YwwtffscVx/VkbL+OoQ7HGGNME2KJQYQpLi3nzhmr6NImgXvOsSYEY4wxtWN1zBHmn59tZHPBAV659lhaJ8SGOhxjjDFNjNUYRJDVOZb3nTgAAAgnSURBVHuZvngLk0encOqA5FCHY4wxpgmyxCBClJSVc+eM1XRMjOO+84eEOhxjjDFNlDUlRIhpCzaxfsc+XrgqlbYtrAnBGGNM3ViNQQTIyC3kmUWbuXhkd04f3DnU4RhjjGnCLDFo4krLK7hzxmqSWsbxwAXWhGCMMaZ+LDEIQEQmiMh6EdkkIncHKHOZiGSKSIaIvOEzr42I5IjI08GM89lFm8nMK+KRi4aR1DIumJsyxhjTDFgfAz9EJBqYBpwJ5ADLRGSOqmZ6lekP3AOcqKp7RKSTz2r+CCwOZpxZ24v414KNnD+8KxOGdQnmpowxxjQTVmPg37HAJlXdoqqHgbeAiT5lbgCmqeoeAFXN98wQkdFAZ+DTYAYpCMf37cBDFw4N5maMMcY0I5YY+NcdyPZ6neNO8zYAGCAiX4nI1yIyAUBEooC/AXcEO8iBXVrz2nXH0SExPtibMsYY00xYU0LdxQD9gXFACrBYRI4GfgHMVdUcEQm4sIhMBaYC9OzZM+jBGmOMMTVhiYF/24AeXq9T3GnecoBvVLUU+E5ENuAkCicAJ4vILUAiECci+1X1Jx0YVXU6MB0gNTVVg7MbxhhjTO1YU4J/y4D+ItJHROKAKcAcnzLv4dQWICIdcZoWtqjqz1W1p6r2xmlOeNU3KTDGGGPClSUGfqhqGXArMA9YB7yjqhki8rCIXOgWmwfsEpFMYCFwp6ruCk3ExhhjTMMQVavFDrXU1FRNS0sLdRjGGNOkiEi6qqaGOo5IYzUGxhhjjKlkiYExxhhjKlliYIwxxphK1scgDIhIAfB9qOPw0RHYGeogaqEpxduUYoWmFW9TihWaVrzhGGsvVU0OdRCRxhID45eIpDWlTj1NKd6mFOv/b+9eQ+Sq7zCOfx+M2CSKVqjXBFNFFPFOBavii1olaEisFITGmlARX4jGkFK8gPhKxHtLxeI1SmNEYsRaUAypIIgVMa13MS8UjUajWOMNtbaPL87JYXYyZ3aXbPY/Mz4fWPbsmbNnn4SZ3WfOOTM/GK68w5QVhivvMGWNHZNTCREREdFIMYiIiIhGikG0uaN0gEkaprzDlBWGK+8wZYXhyjtMWWMH5BqDiIiIaOSIQURERDRSDGIMSXMlPSXpNUmvSlpWOtN4JO0i6V+S/l46y3gk7SVpjaQ3JL0u6eelM7WRtLy+D7wiabWkH5XO1EnSPZK2SHqlY93ektZJ2lh//nHJjNu0ZL2hvh+8JOkRSXuVzNipV96O21ZIcj08LkZQikF0+w5YYfsI4ETgYklHFM40nmVUw66GwR+BJ2wfDhzDgOaWdCBwKfAz20cCu1BNGR0kK4H5XesuB9bbPhRYX389CFayfdZ1wJG2jwbeBK6Y7lB9rGT7vEiaC5wBvDPdgWL6pBjEGLY3295QL39O9YfrwLKp2kmaA5wF3FU6y3gk7QmcCtwNYPtb25+WTdXXDGCmpBnALOD9wnnGsP008EnX6kXAffXyfcDZ0xqqRa+stp+sJ7kC/BOYM+3BWrT83wLcAvwByMVpIyzFIFpJmgccBzxXNklft1L9ovp/6SAT8FPgI+De+tTHXZJmlw7Vi+33gBupnhluBrbafrJsqgnZ1/bmevkDYN+SYSbhd8DjpUP0I2kR8J7tF0tniZ0rxSB6krQ78DBwme3PSufpRdICYIvtF0pnmaAZwPHA7baPA75kcA51j1Gfm19EVWYOAGZLOq9sqslx9ZKrgX9mK+kqqlN4q0pnaSNpFnAlcHXpLLHzpRjEdiTtSlUKVtleWzpPHycDCyW9DTwI/ELSX8tG6msTsMn2tiMwa6iKwiD6JfCW7Y9s/xdYC5xUONNEfChpf4D685bCefqStBRYACz2YL92/BCqkvhi/XibA2yQtF/RVLFTpBjEGJJEdQ78dds3l87Tj+0rbM+xPY/qwrh/2B7YZ7W2PwDelXRYveo04LWCkfp5BzhR0qz6PnEaA3qhZJe/AUvq5SXAowWz9CVpPtVpsIW2vyqdpx/bL9vex/a8+vG2CTi+vk/HiEkxiG4nA7+levb97/rjzNKhRsglwCpJLwHHAtcWztNTfVRjDbABeJnqd8VAvfOdpNXAs8BhkjZJugC4Djhd0kaqox7Xlcy4TUvWPwN7AOvqx9lfiobs0JI3fiDyzocRERHRyBGDiIiIaKQYRERERCPFICIiIhopBhEREdFIMYiIiIhGikHECJE0r9dEvK5tDpC0ZpL7fbvXNL16yt5NHV//XtI19fI1kr6StE/H7V9M5udGxPRLMYj4gbH9vu1fT9HuvgHO6TOC92NgxRT9rIiYBikGESNK0sH1sKYTutY3RxUkLZW0VtITkjZKun6cfc6U9LikC+tV31G98dHylm+5BzhX0t47+M+JiGmSYhAxguq3XX4YWGr7+XE2PxY4FziK6o/43JbtdgceA1bbvrNj/W3A4nqsdLcvqMrBssnkj4hyUgwiRs9PqGYELJ7giNz1trfa/ppqdsNBLds9Ctxr+/7OlfX0zfuBS1u+70/AEkl7TCh9RBSVYhAxerZSDUE6ZYLbf9Ox/D+q8dC9PAPMr4cqdbsVuACY3X2D7U+BB4CLJ5gnIgpKMYgYPd8CvwLOl/SbKdzv1cB/qE4djGH7E+AhqnLQy83ARbSXjogYECkGESPI9pfAAmC5pIVTuOtlwMyWixRvAnq+OsH2x8AjwG5TmCUidoJMV4yIiIhGjhhEREREI8UgIiIiGikGERER0UgxiIiIiEaKQURERDRSDCIiIqKRYhARERGNFIOIiIhofA+LHlVKteXODQAAAABJRU5ErkJggg==">
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We can see that k=9 seems a good choice for our dataset.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p class="more"><a href="../posts/how-to-tune-hyperparameter-in-k-nearest-neighbors-classifier/">Read more…</a></p>
</div>
</div>
</div>
</div>
    </section><footer class="post-meta">
                Sijan Bhandari

        on
                <a href="../categories/knn/">#kNN</a>,

        <time class="post-date" datetime="2020-05-16T14:27:41+05:45">
            2020-05-16 14:27
        </time></footer></article><article class="post post"><header class="post-header"><h2 class="post-title"><a href="../posts/out-of-sample-accuracy-estimation-using-cross-validation-in-python-and-scikit-learn/">Out-of-sample accuracy estimation using Cross validation in python and scikit-learn</a></h2>
    </header><section class="post-excerpt"><div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In this post, we will be continuing from our previous post:</p>
<blockquote>
<p><a href="http://sijanb.com.np/posts/k-nearest-neighbors-algorithm-using-python-and-scikit-learn/">K-Nearest Neighbors Algorithm using Python and Scikit-Learn?</a></p>
</blockquote>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Before starting with the implementation, let's discuss few important points in cross validation.</p>
<blockquote><ol>
<li>Using Cross validation (CV), we splits our dataset into k folds (k generally setup by developer)</li>
<li>Once you created k folds, you use each of the folds as test set during run and all remaining folds as train set.</li>
<li>With cross validation, one can assess the average model performance (this post) or also for the hyperparameters selection (for example : selecting optimal neighbors size(k) in kNN) or selecting good feature
combinations from given data features.</li>
</ol></blockquote>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [1]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">math</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">Counter</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="o">%</span><span class="k">matplotlib</span> inline

<span class="c1"># making results reproducible</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [2]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
    <span class="s1">'https://archive.ics.uci.edu/ml/machine-learning-databases/wine/wine.data'</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">','</span><span class="p">)</span>

<span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'CLASS'</span><span class="p">,</span> <span class="s1">'ALCOHOL_LEVEL'</span><span class="p">,</span> <span class="s1">'MALIC_ACID'</span><span class="p">,</span> <span class="s1">'ASH'</span><span class="p">,</span> <span class="s1">'ALCALINITY'</span><span class="p">,</span><span class="s1">'MAGNESIUM'</span><span class="p">,</span> <span class="s1">'PHENOLS'</span><span class="p">,</span> 
              <span class="s1">'FLAVANOIDS'</span><span class="p">,</span> <span class="s1">'NON_FLAVANOID_PHENOL'</span><span class="p">,</span> <span class="s1">'PROANTHOCYANINS'</span><span class="p">,</span> <span class="s1">'COLOR_INTENSITY'</span><span class="p">,</span> 
              <span class="s1">'HUE'</span><span class="p">,</span> <span class="s1">'OD280/OD315_DILUTED'</span><span class="p">,</span><span class="s1">'PROLINE'</span><span class="p">]</span>

<span class="c1"># Let us use only two features : 'ALCOHOL_LEVEL', 'MALIC_ACID' for this problem</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">'CLASS'</span><span class="p">,</span> <span class="s1">'ALCOHOL_LEVEL'</span><span class="p">,</span> <span class="s1">'MALIC_ACID'</span><span class="p">]]</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[2]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead><tr style="text-align: right;">
<th></th>
      <th>CLASS</th>
      <th>ALCOHOL_LEVEL</th>
      <th>MALIC_ACID</th>
    </tr></thead>
<tbody>
<tr>
<th>0</th>
      <td>1</td>
      <td>14.23</td>
      <td>1.71</td>
    </tr>
<tr>
<th>1</th>
      <td>1</td>
      <td>13.20</td>
      <td>1.78</td>
    </tr>
<tr>
<th>2</th>
      <td>1</td>
      <td>13.16</td>
      <td>2.36</td>
    </tr>
<tr>
<th>3</th>
      <td>1</td>
      <td>14.37</td>
      <td>1.95</td>
    </tr>
<tr>
<th>4</th>
      <td>1</td>
      <td>13.24</td>
      <td>2.59</td>
    </tr>
</tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="1.-Cross--validation-using-Python-from-Scratch">1. Cross  validation using Python from Scratch<a class="anchor-link" href="../posts/out-of-sample-accuracy-estimation-using-cross-validation-in-python-and-scikit-learn/#1.-Cross--validation-using-Python-from-Scratch">¶</a>
</h4>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p class="more"><a href="../posts/out-of-sample-accuracy-estimation-using-cross-validation-in-python-and-scikit-learn/">Read more…</a></p>
</div>
</div>
</div>
</div>
    </section><footer class="post-meta">
                Sijan Bhandari

        on
                <a href="../categories/cross-validation/">#cross-validation</a>,
                <a href="../categories/knn/">#kNN</a>,
                <a href="../categories/machine-learning/">#machine-learning</a>,

        <time class="post-date" datetime="2020-05-09T14:34:17+05:45">
            2020-05-09 14:34
        </time></footer></article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="next">
                <a href="index-2.html" rel="next">Older posts</a>
            </li>
        </ul></nav><script>var disqus_shortname="blog-sijanb-com-np";(function(){var a=document.createElement("script");a.async=true;a.src="https://"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML" integrity="sha256-SDRP1VVYu+tgAGKhddBSl5+ezofHKZeI+OzxakbIe/Y=" crossorigin="anonymous"></script><script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"] ],
        displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
        processEscapes: true
    },
    displayAlign: 'center', // Change this to 'left' if you want left-aligned equations.
    "HTML-CSS": {
        styles: {'.MathJax_Display': {"margin": 0}}
    }
});
</script></main><footer class="site-footer clearfix"><section class="poweredby">Contents © 2020         <a href="mailto:sijanonly@gmail.com">Sijan Bhandari</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         </section></footer>
</div>

    <script type="text/javascript" src="../assets/js/jquery.js"></script><script type="text/javascript" src="../assets/js/jquery.fitvids.js"></script><script type="text/javascript" src="../assets/js/index.js"></script><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-116715433-2"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-116715433-2');
</script>
</body>
</html>
